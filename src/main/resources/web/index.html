<!DOCTYPE html>
<html>
    <head>
        <title>Kiezatlas 2 Website</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0"/>

        <!--link rel="stylesheet" href="/de.kiezatlas.website/vendor/jquery/jquery.mobile.theme-1.3.0.min.css"-->
        <!--link rel="stylesheet" href="/de.kiezatlas.website/vendor/jquery/jquery.mobile-1.3.0.min.css"-->
        <link rel="stylesheet" href="/de.kiezatlas.website/vendor/leaflet/leaflet.css"/>
        <link rel="stylesheet" href="/de.kiezatlas.website/vendor/jquery/ui/css/kiezatlas/jquery-ui-1.9.2.custom.min.css"/>
        <link rel="stylesheet" href="/de.kiezatlas.website/css/sitestyle.css"/>

        <script src="/de.kiezatlas.website/vendor/pouchdb/pouchdb-3.6.0.min.js"></script>
        <script src="/de.kiezatlas.website/vendor/jquery/jquery-1.9.1.min.js"></script>
        <script src="/de.kiezatlas.website/vendor/jquery/ui/js/jquery-ui-1.9.2.custom.min.js"></script>
        <script src="/de.kiezatlas.website/vendor/leaflet/leaflet.js"></script>
        <script src="/de.kiezatlas.website/vendor/leaflet/L.CircleEditor.js"></script>
        <!--script src="/de.kiezatlas.website/vendor/jquery/jquery.mobile-1.3.0.min.js"></script-->
        <script src="/de.kiezatlas.website/ka-website.js"></script>

        <script type="text/javascript">

            // App initialization
            $(document).ready(function(e) {
                if (!isMSIE()) {
                    kiezatlas.start_local_db()
                    kiezatlas.list_entries_in_local_db()
                } else {
                    // ### Update GUI accordingly
                    console.warn("Favourite places feature is unavailable for users of Microsoft Internet Explorer")
                }
                // render all components of the page requested
                kiezatlas.render_page()
            })

            // Current MSIE Check courtesy of http://www.javascriptkit.com
            function isMSIE() {
                var ie11andabove = navigator.userAgent.indexOf('Trident') != -1 && navigator.userAgent.indexOf('MSIE') == -1 // IE11 or above Boolean
                var ie10andbelow = navigator.userAgent.indexOf('MSIE') != -1 // IE10 or below Boolean
                return (ie11andabove || ie10andbelow)
            }

            // Fulltext Search Handler
            function search_fulltext() {
                var query = $("#fulltext-search").val()
                if (query.length >= 1) {
                    query = encodeURIComponent(query + "*", "UTF-8")
                    kiezatlas.do_text_search_geo_objects(query, kiezatlas.render_geo_objects)
                } else {
                    console.log("Text query was empty, skipping search")
                }
            }

            // Near-By Search Handler
            function search_near_by_input() {
                var streetFocus = $("#near-by").val() + ' Berlin'
                    streetFocus = encodeURIComponent(streetFocus, "UTF-8")
                kiezatlas.show_spinning_wheel(true)
                $.ajax({
                    type: "GET", url: "/kiezatlas/geocode/" + streetFocus,
                    /** beforeSend: function(xhr) {
                        xhr.setRequestHeader("Content-Type", "application/json")
                        xhr.setRequestHeader("Charset", "UTF-8")
                    }, **/
                    success: function(obj) {
                        kiezatlas.hide_spinning_wheel(true)
                        kiezatlas.alternative_items = null
                        kiezatlas.alternative_items = obj.results
                        kiezatlas.autocomplete_item = 0
                        if (kiezatlas.alternative_items.length === 1) {
                            focus_current_item()
                            render_alternatives()
                            if (kiezatlas.alternative_items.length <= 1) {
                                $('#street-alternatives').hide()
                            }
                        } else if (kiezatlas.alternative_items.length > 1) {
                            focus_current_item() // focus the first result
                            render_alternatives()
                        }
                    },
                    error: function(x, s, e) {
                        console.warn("ERROR", "x: " + x + " s: " + s + " e: " + e)
                        kiezatlas.hide_spinning_wheel(true)
                    }
                })

                function focus_current_item() {
                    var item = kiezatlas.alternative_items[kiezatlas.autocomplete_item]
                    if (typeof item !== "undefined") {
                        kiezatlas.current_location.coordinate = new L.latLng(item.geometry.location.lat, item.geometry.location.lng)
                        kiezatlas.default_radius = 900
                        // console.log("geo-coded item", item)
                        kiezatlas.current_location.name = item['formatted_address']
                        kiezatlas.update_current_location_label()
                        kiezatlas.handle_option_b()
                        kiezatlas.render_circle_search_control()
                        kiezatlas.do_circle_search(undefined, undefined, kiezatlas.render_geo_objects)
                        kiezatlas.map.setView(kiezatlas.current_location.coordinate, kiezatlas.LEVEL_OF_STREET_ZOOM)
                        // $("#near-by").val(item['formatted_address'])
                        // Display location
                        /** if (kiezatlas.location_circle != undefined) {
                            kiezatlas.map.removeLayer(kiezatlas.location_circle);
                        }
                        kiezatlas.location_circle = new L.circle(item.geometry.location, 200, {"stroke": true,
                            "clickable": false, "color": "#dae3f8", "fillOpacity": 0.6, "opacity": 0.8, "weight":10});
                        kiezatlas.map.addLayer(kiezatlas.location_circle, {"clickable" : false}); **/
                    }
                }

                function render_alternatives() {
                    // 
                    var prev_location = kiezatlas.alternative_items[kiezatlas.autocomplete_item - 1]
                    var next_location = kiezatlas.alternative_items[kiezatlas.autocomplete_item + 1]
                    var $prev = ""
                    var $next = ""
                    if (typeof prev_location !== "undefined") {
                        $prev = $('<a class="prev-location" title="'+ prev_location['formatted_address'] +'"><</a>')
                        $prev.click(function(e) {
                            kiezatlas.autocomplete_item = kiezatlas.autocomplete_item - 1
                            focus_current_item()
                            render_alternatives()
                        })
                    } else {
                        // empty prev button
                        $prev = $('<a class="prev-location defused" title=""><</a>')
                    }

                    if (typeof next_location !== "undefined") {
                        $next = $('<a class="next-location" title="'+ next_location['formatted_address'] +'">></a>')
                        $next.click(function(e) {
                            kiezatlas.autocomplete_item = kiezatlas.autocomplete_item + 1
                            focus_current_item()
                            render_alternatives()
                        })
                    } else {
                        // empty next button
                        $next = $('<a class="next-location defused" title="">></a>')
                    }
                    // 
                    $('#street-alternatives').html(kiezatlas.alternative_items.length + ' Orte gefunden')
                            .append($prev).append($next)
                    $('#street-alternatives').css("display", "inline-block")
                    $('#street-alternatives').show()
                }
                // if (!checkIfAllCategoriesSelected()) showAllMarker();
            }

        </script>
    </head>
    <body class="kiezatlas">

        <div id="navigation"></div>
        
        <div id="header">
            <div class="welcome">
                <img src="/de.kiezatlas.website/images/kiezatlas2-logo.png" width="150" />
                <h3>Willkommen im Kiezatlas!</h3>
                <p>
                    Im Kiezatlas findest du Berliner <b>Einrichtungen</b> und <b>Angebote</b>.
                </p>
            </div>
        </div>

        <div id="filter-container"></div>

        <div id="karte">

            <!-- Favourite locations dialog -->
            <h3 class="location-label">
                <span class="text"></span>
                <button class="star no-favs">
                    <img class="fav-icon" title="zu Favoriten hinzufÃ¼gen" alt="Icon: Favourite this location."
                         src="/de.kiezatlas.website/images/1441217865_black_5_favorite_star.png"/>
                </button>
            </h3>

            <!-- Location detection by text delivers alternatives -->
            <div id="street-alternatives"></div>
            <ul id="places">
                <li class="ui-menu-item ui-corner-all ui-widget-content">
                    <a href="#">Favoriten</a>
                    <ul class="entries submenu"></ul>
                </li>
            </ul>

            <!-- Something happens area -->
            <div id="message" class="notification">Test test..</div>
            <div id="spinning-wheel">
                <img src="/de.kiezatlas.website/images/ajax-loader.gif" />
            </div>

            <!-- Leaflet Area -->
            <div id="map" class="fullsize"></div>

            <!--- Filter & Map Controls Area -->
            <div class="legende">
                <div class="text-search-control">
                    <form action="javascript:search_fulltext()" id="fulltext-search-form"
                                        accept-charset="UTF-8">
                        <img src="/de.kiezatlas.website/images/soziale_einrichtung_circle_ye.png" title="Markierer: Einrichtungen"/> Einrichtungen
                        <img src="/de.kiezatlas.website/images/soziale_einrichtung_circle_ye.png"
                             title="Markierer: Angebote"/> Angebote
                        <!--label for="fulltext" id="fulltext-search-label"></label-->
                        <input id="fulltext-search" type="text" placeholder="Volltextsuche" />
                        <input id="fulltext-do" type="submit" class="btn" value="Suchen" />
                    </form>
                </div>
                <a href="javascript:kiezatlas.toggle_circle_search_lock_button()" class="lock-control">Unlock Circle</a>
            </div>

        </div>

        <!-- Info area -->
        <div id="detail-area">
            <!--h3 class="help">Ausgew&auml;hlter Ort</h3-->
            <div class="search-option d">
                Bitte w&auml;hlen sie einen Markierer auf der <a href="#karte">Karte</a> aus um weitere Details zu
                erhalten.
            </div>
        </div>

        <!-- Location detection menu -->
        <div id="main-menu">
            <h3><a href="javascript:kiezatlas.toggle_location_menu();">In der N&auml;he von...</a></h3>
            <div class="options">
                <p>
                    Du hast drei M&ouml;glichkeiten um mit unserer Umkreissuche Informationen aus einer ganz
                    bestimmten Berliner Gegend abzufragen.
                </p>
                <!--p>Bitte teile uns einen Standort mit damit wir Dir Infos aus der Umgebung liefern k&ouml;nnen (A, B) oder nutze (C) unsere grafische Umkreissuche!</p-->
                <div class="search-option a">
                    <h1 id="a">A)</h1>
                    <b>Deinen aktuellen Standort freigeben</b><br/>
                    Mit Hilfe deines Web-Browsers kannst du einfach per Klick <a href="javascript:kiezatlas.get_browser_location()">deinen aktuellen Standort</a> als Ausgangspunkt f&uuml;r die Umkreissuche benutzen.
                </div>
                <div class="search-option b">
                    <h1 id="b">B)</h1>
                    <b>Name eines Platzes oder einer Stra&szlig;e eingeben</b><br/>
                    Du kannst auch einfach den Namen eines Platzes oder einer Stra&szlig;e in Berlin eingeben.<br/>
                    <div id="location-input">
                        <form action="javascript:search_near_by_input()" id="near-by-form" accept-charset="UTF-8">
                            <!-- label for="near-by" id="near-by-label">In der N&auml;he von</label-->
                            <input id="near-by" type="text" placeholder="Stra&szlig;enname / Hnr." />
                            <input id="do-nearby" type="submit" class="btn" value="Ok" />
                            <div class="spinning-wheel">
                                <img src="/de.kiezatlas.website/images/ajax-loader.gif" />
                            </div>
                        </form>
                    </div>
                </div>
                <div class="search-option c">
                    <h1 id="c">C)</h1>
                    <b>Grafische Umkreissuche auf der Karte</b><br/>
                    Du kannst den <i>grauen Kreis</i> auf der <a href="#karte">Karte</a> einfach
                    anfassen,
                    <i>
                        verschieben</i> und ggf. vergr&ouml;&szlig;ern. Probier es mal aus!
                </div>
            </div>
            <p>
                <b>Tipp:</b> Eine Liste von Lieblingsstandorten kannst du mit unserer Favoriten-Funktion in deinem Browser speichern. Diese Standorte speichern wir dann nur in deinem Browser und nicht bei Kiezatlas.
            </p>
        </div>

        <!-- Kiezatlas Standard Website section -->
        <div id="pages">
            <ul>
                <li><a href="/aktuelles">Aktuelles</a></li>
                <li><a href="/projektbeschreibung">Projektbeschreibung</a></li>
                <li><a href="/dies-das">Dies und Das</a></li>
                <li><a href="/weitere-atlanten">Weitere Atlanten</a></li>
                <li><a href="http://pax.spinnenwerk.de/~kiezatlas/index.php?id=6">Impressum</a></li>
                <li><a href="/datenschutzhinweise">Datenschutzhinweise</a></li>
                <li><a href="/api-documentation">API</a></li>
                <li><a href="/open-source">Open Source</a></li>
                <li><a href="/links">Links</a></li>
            </ul>
            <p></p>
        </div>

        <div id="bottom">
            <div class="sozialraumdaten">
                <h3>Datenbank lebensweltlich orientierte R&auml;ume (LOR)</h3>
                <p>
                    Ein Herzst&uuml;ck sind die <a href="http://sozialraumdaten.kiezatlas.de/" title="Ãffnet externen Link in neuem Fenster" target="_blank" class="external-link">
                    Lebensweltlich orientierten Planungsraum = LOR &ndash; Daten</a>, die wir in Kooperation vom Amt fÃ¼r Statistik Berlin-Brandenburg fÃ¼r das Projekt Kiezatlas erhalten und aufbereiten.
                    <br/><br/>
                    Aktueller Stand: Dezember 2014
                </p>
                <div class="link-area">
                    <a href="http://sozialraumdaten.kiezatlas.de/">
                        <img src="/de.kiezatlas.website/images/lor_sozialraumdaten_diagramm_green467_pure.png" style="border: 0px;" alt="Grafik: Diagramm zur Altersverteilung im Kiez Victoriastadt">
                        <br/>Link zu den Sozialraumdaten
                    </a>
                </div>
                <div class="link-area">
                    <a href="http://sozialraumdaten.kiezatlas.de/seiten/" title="Kartograpischer Zugang zu den LOR-Auswertungen">
                        <img src="/de.kiezatlas.website/images/lor_sozialraumdaten_einstiegskarte_445.jpg" style="border: 0px;" alt="Grafik: Diagramm zur Altersverteilung der 40-45j&auml;hrigen">
                        <br/>Geographische Auswertung der LOR&ndash;Seiten
                    </a>
                </div>
            </div>
            <p>
                <b>Kontakt</b><br/>
                GskA &ndash; Projekt Network, Tucholskystr. 11, 10117 Berlin<br/>
                Fon: 030 / 280 961 10, E-Mail: <a href="mailto:info@kiezatlas.de">info@kiezatlas.de</a><br/>
            </p>
        </div>

        <!-- Kiezatlas District Menu -->
        <div class="district-area">
            <h4>Bezirke im Kiezatlas und ihre Stadtpl&auml;ne</h4>
            <ul class="bezirke"></ul>
        </div>

        <!-- Piwik -->
        <!-- script type="text/javascript">
        var pkBaseURL = "http://stats.kiezatlas.de/";
        document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
        </script><script type="text/javascript">
        try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 2);
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
        } catch( err ) {}
        </script><noscript><p><img src="http://stats.kiezatlas.de/piwik.php?idsite=2" style="border:0" alt="" /></p></noscript>
        <!-- End Piwik Tracking Code -->

    </body>
</html>

