<!DOCTYPE html>
<html>
    <head>
        <title>Kiezatlas Website</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0"/>

        <!--link rel="stylesheet" href="/de.kiezatlas.website/vendor/jquery/jquery.mobile.theme-1.3.0.min.css"-->
        <!--link rel="stylesheet" href="/de.kiezatlas.website/vendor/jquery/jquery.mobile-1.3.0.min.css"-->
        <link rel="stylesheet" href="/de.kiezatlas.website/vendor/leaflet/leaflet.css"/>
        <link rel="stylesheet" href="/de.kiezatlas.website/vendor/jquery/ui/css/kiezatlas/jquery-ui-1.9.2.custom.min.css"/>
        <link rel="stylesheet" href="/de.kiezatlas.website/css/sitestyle.css"/>

        <script src="/de.kiezatlas.website/vendor/pouchdb/pouchdb-3.6.0.min.js"></script>
        <script src="/de.kiezatlas.website/vendor/jquery/jquery-1.9.1.min.js"></script>
        <script src="/de.kiezatlas.website/vendor/jquery/ui/js/jquery-ui-1.9.2.custom.min.js"></script>
        <script src="/de.kiezatlas.website/vendor/leaflet/leaflet.js"></script>
        <script src="/de.kiezatlas.website/vendor/leaflet/L.CircleEditor.js"></script>
        <!--script src="/de.kiezatlas.website/vendor/jquery/jquery.mobile-1.3.0.min.js"></script-->
        <script src="/de.kiezatlas.website/ka-website.js"></script>
        <script type="text/javascript">
            
            $(document).ready(function(e) {
                // kiezatlas.init_map_area('map')
                kiezatlas.start_local_db()
                kiezatlas.list_entries_in_local_db()
                kiezatlas.init_location_selection()
                //
                // kiezatlas.update_current_location_label(true) // implicitly queries for geo_objects
                kiezatlas.render_location_button()
            })
            
            /** function search_fulltext() {
                var query = $("#fulltext").val()
                    query = encodeURIComponent(query, "UTF-8")
                kiezatlas.search_geo_objects(query, kiezatlas.render_geo_objects)
            } **/
            
            function search_near_by_input () {
                var streetFocus = $("#near-by").val() + ' Berlin'
                    streetFocus = encodeURIComponent(streetFocus, "UTF-8")
                kiezatlas.show_spinning_wheel(true)
                $.ajax({
                    type: "GET", url: "/kiezatlas/geocode/" + streetFocus,
                    /** beforeSend: function(xhr) {
                        xhr.setRequestHeader("Content-Type", "application/json")
                        xhr.setRequestHeader("Charset", "UTF-8")
                    }, **/
                    success: function(obj) {
                        kiezatlas.hide_spinning_wheel(true)
                        kiezatlas.alternative_items = null
                        kiezatlas.alternative_items = obj.results
                        kiezatlas.autocomplete_item = 0
                        if (kiezatlas.alternative_items.length === 1) {
                            focus_current_item()
                            render_alternatives()
                            if (kiezatlas.alternative_items.length <= 1) {
                                $('#street-alternatives').hide()
                            }
                        } else if (kiezatlas.alternative_items.length > 1) {
                            focus_current_item() // focus the first result
                            render_alternatives()
                        }
                    },
                    error: function(x, s, e) {
                        console.warn("ERROR", "x: " + x + " s: " + s + " e: " + e)
                        kiezatlas.hide_spinning_wheel(true)
                    }
                })

                function focus_current_item () {
                    var item = kiezatlas.alternative_items[kiezatlas.autocomplete_item]
                    if (typeof item !== "undefined") {
                        kiezatlas.current_location.coordinate = new L.latLng(item.geometry.location.lat, item.geometry.location.lng)
                        kiezatlas.default_radius = 900
                        console.log("geo-coded item", item)
                        kiezatlas.current_location.name = item['formatted_address']
                        kiezatlas.update_current_location_label()
                        kiezatlas.handle_option_b()
                        kiezatlas.render_radius_control()
                        kiezatlas.query_geo_objects(undefined, undefined, kiezatlas.render_geo_objects)
                        kiezatlas.map.setView(kiezatlas.current_location.coordinate, kiezatlas.LEVEL_OF_STREET_ZOOM)
                        // $("#near-by").val(item['formatted_address'])
                        // Display location
                        /** if (kiezatlas.location_circle != undefined) {
                            kiezatlas.map.removeLayer(kiezatlas.location_circle);
                        }
                        kiezatlas.location_circle = new L.circle(item.geometry.location, 200, {"stroke": true,
                            "clickable": false, "color": "#dae3f8", "fillOpacity": 0.6, "opacity": 0.8, "weight":10});
                        kiezatlas.map.addLayer(kiezatlas.location_circle, {"clickable" : false}); **/
                    }
                }

                function render_alternatives () {
                    // 
                    var prev_location = kiezatlas.alternative_items[kiezatlas.autocomplete_item - 1]
                    var next_location = kiezatlas.alternative_items[kiezatlas.autocomplete_item + 1]
                    var $prev = ""
                    var $next = ""
                    if (typeof prev_location !== "undefined") {
                        $prev = $('<a class="prev-location" title="'+ prev_location['formatted_address'] +'"><</a>')
                        $prev.click(function(e) {
                            kiezatlas.autocomplete_item = kiezatlas.autocomplete_item - 1
                            focus_current_item()
                            render_alternatives()
                        })
                    } else {
                        // empty prev button
                        $prev = $('<a class="prev-location defused" title=""><</a>')
                    }

                    if (typeof next_location !== "undefined") {
                        $next = $('<a class="next-location" title="'+ next_location['formatted_address'] +'">></a>')
                        $next.click(function(e) {
                            kiezatlas.autocomplete_item = kiezatlas.autocomplete_item + 1
                            focus_current_item()
                            render_alternatives()
                        })
                    } else {
                        // empty next button
                        $next = $('<a class="next-location defused" title="">></a>')
                    }
                    // 
                    $('#street-alternatives').html(kiezatlas.alternative_items.length + ' Orte gefunden')
                            .append($prev).append($next)
                    $('#street-alternatives').css("display", "inline-block")
                    $('#street-alternatives').show()
                }
                // if (!checkIfAllCategoriesSelected()) showAllMarker();
            }

        </script>
    </head>
    <body class="kiezatlas">

        <div id="navigation">
            <!--
            <a href="/" class="active">Home</a>
            <a href="/aktuelles">Aktuelles</a>
            <a href="/projekt">Projektbeschreibung</a>
            <a href="/bezirke">Bezirke</a>
            <a href="/weitere-atlanten">Weitere Atlanten</a>
                <!--a href="/weitere-atlanten/wip">WIP</a-->
                <!--a href="/weitere-atlanten/archiv">Archiv</a-->
            <!--a href="/dies-und-das">Dies & Das</a-->
                <!--a href="/dies-und-das/archiv">Archiv</a-->
            <!--a href="/tipps-und-tricks">Tipps & Tricks</a>
            <a href="/impressum">Impressum</a>
            <!-- a href="/suche">Suche</a-->
            <!--a href="/links">Links</a>
            <a href="/kontakt">Kontakt</a>
            <a href="/open-source">Open Source</a-->
        </div>
        
        <div id="header">
            <div class="welcome">
                <img src="/de.kiezatlas.website/images/kiezatlas-logo.png" />
                <h3>Willkommen im Kiezatlas!</h3>
                <p>
                    Im Kiezatlas findest du Berliner <b>Einrichtungen</b> und <b>Angebote</b>.
                </p>
            </div>
        </div>

        <div id="filter-container">
            <!-- div id="fulltext-input">
                <form action="javascript:search_fulltext()" id="fulltext-form" accept-charset="UTF-8">
                    <label for="fulltext" id="fulltext-label">Volltextsuche</label>
                    <input id="fulltext" type="text" placeholder="Name"></input>
                    <input id="do-search" type="submit" class="btn" value="Ok"></input>
                </form>
            </div-->
        </div>

        <div id="karte">
            <!--input type="text" class="location-input" /-->
            <h3 class="location-label">
                <span class="text"></span>
                <button class="star">
                    <img class="fav-icon" title="zu Favoriten hinzufÃ¼gen" alt="Icon: Favourite this location."
                         src="/de.kiezatlas.website/images/1441217865_black_5_favorite_star.png"/>
                </button>
            </h3>
            <div id="street-alternatives"></div>
            <ul id="places">
                <li class="ui-menu-item ui-corner-all ui-widget-content">
                    <a href="#">Favoriten</a>
                    <ul class="entries submenu"></ul>
                </li>
            </ul>
            <div id="message" class="notification">Test test..</div>
            <div id="map" class="fullsize">
                <div id="spinning-wheel">
                    <img src="/de.kiezatlas.website/images/ajax-loader.gif" />
                </div>
            </div>
            <div class="legende">
                <img src="/de.kiezatlas.website/images/soziale_einrichtung_circle_ye.png" title="Markierer: Soziale Einrichtung"/>
                Soziale Einrichtung
            </div>
        </div>

        <div id="detail-area">
            <h3>Ausgew&auml;hlter Ort</h3>
            <div class="search-option d">
                Bitte klicke auf einen der gelben Punkte in der <a href="#karte">Karte</a> um Details zu diesem Ort angezeigt zu bekommen.
            </div>
        </div>

        <div id="main-menu">
            <h3>Standortangabe</h3>
            <p>
                Du hast drei M&ouml;glickeiten um mit unserer Umkreissuche Informationen aus einer ganz bestimmten Berliner Gegend abzufragen.
            </p>
            <!--p>Bitte teile uns einen Standort mit damit wir Dir Infos aus der Umgebung liefern k&ouml;nnen (A, B) oder nutze (C) unsere grafische Umkreissuche!</p-->
            <div class="search-option a">
                <h1 id="a">A)</h1>
                <b>Deinen aktuellen Standort freigeben</b><br/>
                Mit Hilfe deines Web-Browsers kannst du einfach per Klick <a href="javascript:kiezatlas.get_browser_location()">deinen aktuellen Standort</a> als Ausgangspunkt f&uuml;r die Umkreissuche benutzen.
            </div>
            <div class="search-option b">
                <h1 id="b">B)</h1>
                <b>Name eines Platzes oder einer Stra&szlig;e eingeben</b><br/>
                Du kannst auch einfach den Namen eines Platzes oder einer Stra&szlig;e in Berlin eingeben.<br/>
                <div id="location-input">
                    <form action="javascript:search_near_by_input()" id="near-by-form" accept-charset="UTF-8">
                        <!-- label for="near-by" id="near-by-label">In der N&auml;he von</label-->
                        <input id="near-by" type="text" placeholder="Stra&szlig;enname / Hnr." />
                        <input id="do-nearby" type="submit" class="btn" value="Ok" />
                        <div class="spinning-wheel">
                            <img src="/de.kiezatlas.website/images/ajax-loader.gif" />
                        </div>
                    </form>
                </div>
            </div>
            <div class="search-option c">
                <h1 id="c">C)</h1>
                <b>Grafische Umkreissuche auf der Karte</b><br/>
                Du kannst den <i>grauen Kreis</i> auf der <a href="#karte">Karte</a> einfach anfassen, <i>verschieben</i> und ggf. vergr&ouml;&szlig;ern. Probier es mal aus!
            </div>
            <p>
                <b>Tipp:</b> Eine Liste von Lieblingsstandorten kannst du mit unserer Favoriten-Funktion in deinem Browser speichern. Diese Standorte speichern wir dann nur in deinem Browser und nicht bei Kiezatlas.
            </p>
        </div>

        <div id="bottom">
            <a href="http://pax.spinnenwerk.de/~kiezatlas/weitere-atlanten.html">Weitere Atlanten</a>
            <p>
                <b>Kontakt</b><br/>
                GskA &ndash; Projekt Network, Tucholskystr. 11, 10117 Berlin<br/>
                Fon: 030 / 280 961 10<br/>
                E-Mail: <a href="mailto:info@kiezatlas.de">info@kiezatlas.de</a><br/>
            </p>
            <p>
                <a href="http://pax.spinnenwerk.de/~kiezatlas/index.php?id=6">Impressum</a><br/>
                Datenschutzhinweise<br/>
            </p>
            <p>
                <a href="http://www.github.com/mukil/dm4-kiezatlas-website">Open Source</a><br/>
                <a href="http://pax.spinnenwerk.de/~kiezatlas/links.html">Links</a><br/>
            </p>
        </div>

        <img src="http://stats.kiezatlas.de/piwik.php?idsite=2&amp;rec=1&action_name=kiezatlas-Kreise" style="border:0 display: none;" alt="" />

    </body>
</html>

