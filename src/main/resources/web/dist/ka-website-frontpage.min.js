function search_fulltext_geo_objects(){query=kiezatlas.get_fulltext_search_input(),query.length>=1&&(query=encodeURIComponent(query,"UTF-8"),kiezatlas.is_angebote_mode()?kiezatlas.do_text_search_angebotsinfos(query,!0):kiezatlas.do_text_search_geo_objects(query,void 0,!0))}function handle_fulltext_search_input(a){13===a.keyCode&&do_fulltext_search()}function do_fulltext_search(){query=kiezatlas.get_top_search_input(),query.length>=1&&($("#fulltext-search").val(query),kiezatlas.hide_sidebar(),kiezatlas.do_text_search_geo_objects(query,void 0,!0))}function cleanUpAddress(a){if(a)return a.replace(" Deutschland","")}function search_location_by_text(){var a=$("#near-by").val()+" Berlin, Deutschland";a=encodeURIComponent(a,"UTF-8"),$(".location-search-info").hide(),kiezatlas.district&&kiezatlas.clear_district_filter(),kiezatlas.show_spinning_wheel(!0),restc.do_geocode(a,function(a){kiezatlas.hide_spinning_wheel(!0),a.hasOwnProperty("results")?(kiezatlas.set_locationsearch_results(a.results),kiezatlas.set_autocomplete_item(0),1===a.results.length?(kiezatlas.focus_locationsearch_result(),$("#street-alternatives").hide()):a.results.length>1?(kiezatlas.focus_locationsearch_result(),kiezatlas.show_locationsearch_alternatives()):($(".location-search-info").html("Keinen Ort f&uuml;r diese Anfrage gefunden"),$(".location-search-info").show())):(console.warn("ERROR","x: "+x+" s: "+s+" e: "+e),$(".location-search-info").html('Es ist in Fehler bei der Suche aufgetreten bitte probieren sie es erneut. Sollte dieser Fehler wiederholt auftreten bitte informieren sie uns per Email unter <a href="mailto:support@kiezatlas.de">support@kiezatlas.de</a>.'),$(".location-search-info").show())})}function create_list_item(a){return $('<li class="item" data-topic-id="'+a.id+'"><h3>'+a.name+', <span class="anschrift">'+a.anschrift.replace(" Deutschland","")+'</span>, <a href="javascript:citymap.show_selected_detail('+a.id+', true);">mehr Infos</a></h3></li>')}function hide_loading_indicator(){$(".citymap .ui.search button .icon").removeClass("loading").removeClass("circle").removeClass("notched"),$(".citymap .ui.search button .icon").addClass("search")}function show_loading_indicator(){$(".citymap .ui.search button .icon").addClass("loading").addClass("circle").addClass("notched"),$(".citymap .ui.search button .icon").removeClass("search")}var restc=function(a){function b(a,b){var c=a.value,d=b.value;return c.toLowerCase()>d.toLowerCase()?1:c.toLowerCase()<d.toLowerCase()?-1:0}jQuery.ajaxSetup({cache:!1});var c={};return c.do_geocode=function(b,c){a.ajax({type:"GET",url:"/website/geocode?query="+b,success:function(a){c(a)},error:function(a,b,d){c(d)}})},c.create_location_string=function(a){return a.lng.toFixed(4)+", "+a.lat.toFixed(4)},c.get_places_nearby=function(b,d,e){var f=c.create_location_string(b),g=d;d||(g=750),a.getJSON("/website/search/"+encodeURIComponent(f)+"/"+g/1e3,e)},c.do_reverse_geocode=function(b,c,d){a.getJSON("/website/reverse-geocode/"+b.get_current_location_lat()+","+b.get_current_location_lng(),function(a){if(c&&c.hide_spinning_wheel(!0),a.results.length>0){var e=a.results[0],f=e.address_components,g={coordinates:""+b.get_current_location_lat()+","+b.get_current_location_lng()};for(var h in f){var i=f[h];"route"===i.types[0]?"undefined"!=typeof i.long_name&&(g.street=i.long_name):"sublocality_level_1"===i.types[0]?"undefined"!=typeof i.long_name&&i.long_name&&(g.district=i.long_name.replace("Bezirk ","")):"street_number"===i.types[0]?"undefined"!=typeof i.long_name&&i.long_name&&(g.street_nr=i.long_name):"locality"===i.types[0]?"undefined"!=typeof i.long_name&&i.long_name&&(g.city=i.long_name):"postal_code"===i.types[0]&&"undefined"!=typeof i.long_name&&i.long_name&&(g.postal_code=i.long_name)}var j=g.street+" ";g.street_nr&&(j+=g.street_nr+", "),g.district?j+=" "+g.district:g.city&&(j+=" "+g.city),b.set_current_location_name(j),c&&c.render_current_location_label(),d&&d(g)}})},c.load_current_angebotsinfos=function(b){a.getJSON("/angebote/locations",function(a){b(a)})},c.load_related_angebotsinfos=function(b,c){a.getJSON("/angebote/list/assignments/geo/"+b,function(a){c(a)})},c.load_view_permissions=function(b){a.getJSON("/website/menu",function(a){b(a)})},c.load_angebotsinfo=function(b,c){a.getJSON("/angebote/"+b+"/json",function(a){c(a)})},c.load_districts=function(c){a.getJSON("/website/bezirk",function(a){a.sort(b),c(a)})},c.load_search_keywords=function(b,c){var d="/website/search-keywords";b&&(d+="?query="+b),a.getJSON(d,function(a){c(a)})},c.load_district_topics=function(b,c){b&&!isNaN(b)?a.getJSON("/website/bezirk/"+b,function(a){c(a)}):c("No district ID given, skipping request id=",b)},c.load_district_regions=function(b,c){b&&!isNaN(b)?a.getJSON("/website/bezirk/"+b+"/bezirksregionen",function(a){c(a)}):c("No district ID given, skipping request id=",b)},c.load_website_geoobjects=function(b,c){a.getJSON("/website/"+b+"/geo",function(a){c(a)})},c.load_geo_objects_by_category=function(b,c,d){a.getJSON("/website/"+b+"/geo/"+c,function(a){d&&d(a)})},c.load_website_info=function(b,c){a.getJSON("/website/info/"+b,function(a){c(a)})},c.load_topics_by_type=function(b,c){a.getJSON("/core/topic/by_type/"+b,function(a){c(a)})},c.load_website_facets=function(b,c){a.getJSON("/site/"+b+"/facets/typedefs",function(a){c(a)})},c.load_websites=function(b){a.getJSON("/website/sites/json",function(a){b(a)})},c.remove_website_assignment=function(b,c,d){a.ajax({type:"DELETE",url:"/site/"+b+"/"+c,success:function(){d({state:"ok"})},error:function(a,b,c){d({state:"error",detail:c}),console.warn("Deleting geo-website assignment failed",a,b,c)}})},c.create_website_assignment=function(b,c,d){a.ajax({type:"POST",url:"/site/"+b+"/"+c,success:function(){d({state:"ok"})},error:function(a,b,c){d({state:"error",detail:c}),console.warn("Deleting geo-website assignment failed",a,b,c)}})},c.create_user_assignment=function(b,c,d){a.ajax({type:"POST",url:"/website/assign/"+b+"/"+c,success:function(){console.log("Successfully created a kiezatlas topic-user assignment"),d({state:"ok"})},error:function(a,b,c){d({state:"error",detail:c}),console.log("Creating a kiezatlas topic-user assignment failed",a,b,c)}})},c.delete_user_assignment=function(b,c,d){a.ajax({type:"DELETE",url:"/website/assign/"+b+"/"+c,success:function(){console.log("Successfully deleted kiezatlas topic-user assignment"),d({state:"ok"})},error:function(a,b,c){d({state:"error",detail:c}),console.log("Deleting kiezatlas topic-user assignment failed",a,b,c)}})},c.create_comment=function(b,c,d,e,f){a.ajax({type:"POST",url:"/website/comment/"+b+"/"+c+"/"+d+"/"+e,success:function(){console.log("Successfully created a kiezatlas topic-user assignment"),f({state:"ok"})},error:function(a,b,c){f({state:"error",detail:c}),console.log("Creating a kiezatlas topic-user assignment failed",a,b,c)}})},c.update_facets=function(b,c,d,e){a.ajax({type:"PUT",url:"/website/edit/"+c+"/facets/"+b,data:JSON.stringify(d),contentType:"application/json",success:function(){console.log("Successfully updated geo-objects site facets"),e({state:"ok"})},error:function(a,b,c){e({state:"error",detail:c}),console.log("Updating geo-website site facets failed",a,b,c)}})},c.load_news_items=function(b,c){a.getJSON("/website/newsfeed/"+b,function(a){c(a)})},c.load_facetted_geo_object=function(b,c,d){a.getJSON("/website/geo/"+b+"/facetted/"+c,function(a){a?d(a):console.warn("Error while loading details for core topic ",a)})},c.load_geo_object_detail=function(b,c){a.getJSON("/website/geo/"+b,function(a){a?c(a):console.warn("Error while loading details for geo object",a)})},c.logout=function(){a.post("/accesscontrol/logout",function(a){a||kiezatlas.render_user_menu(!1)})},c.is_logged_in=function(b){a.get("/accesscontrol/user",function(a){return a&&a.length>0?void b(!0):void b(!1)})},c.create_cookie=function(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+b+e+"; path=/"},c.read_cookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null},c.erase_cookie=function(a){c.create_cookie(a,"",-1)},c}($),mapping={zoom_detail:15,zoom_street:14,zoom_kiez:13,zoom_district:12,zoom_city:11,marker_radius_fixed:!1,marker_radius:10,marker_radius_selected:15,circle_search_radius:750,circle_search_control:void 0,circle_query:!0,circle_locked:!0,current_location:{name:"Tucholskystraße, 10117 Berlin",coordinate:new L.latLng(52.524256,13.392192)},max_bounds:L.latLngBounds(L.latLng(52.234807,12.976094),L.latLng(52.84337,13.958482)),marker_group:void 0,control_group:L.featureGroup(),do_cluster_marker:!1,fit_bounds_padding:30,angebote_mode:!1},leafletMap=function(a,b){function c(){f.set_current_location_name('Ihr Standort liegt au&szlig;erhalb von Berlin, bitte nutzen sie die Umkreissuche oder <a href="javascript:kiezatlas.focus_location_input_field()" >die Texteingabe</a>.'),f.map.setView(f.get_current_location_coords()),f.map.setZoom(mapping.zoom_kiez),f.fire_location_error("Ihr Standort ist a&uszlig;erhalb von Berlin.")}function d(a,b,c){if(e){var d=document.createEvent("CustomEvent");d.initCustomEvent(b,!0,!1,c),a.dispatchEvent(d)}else a.dispatchEvent(new CustomEvent(b,{detail:c}))}function e(){var a=navigator.userAgent.indexOf("Trident")!=-1&&navigator.userAgent.indexOf("MSIE")==-1,b=navigator.userAgent.indexOf("MSIE")!=-1;return a||b}var f={},g=[];return f.setup=function(a,c){f.elementId=a,f.map=new b.Map(a,{dragging:!0,touchZoom:!0,scrollWheelZoom:!1,doubleClickZoom:!0,zoomControl:!1,minZoom:9,max_bounds:mapping.max_bounds}),f.zoom=b.control.zoom({position:"topright"}),f.zoom.addTo(f.map),b.control.scale({imperial:!1,updateWhenIdle:!0}).addTo(f.map),b.tileLayer("https://api.tiles.mapbox.com/v4/kiezatlas.pd8lkp64/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoia2llemF0bGFzIiwiYSI6ImNpa3BndjU2ODAwYm53MGxzM3JtOXFmb2IifQ._PcBhOcfLYDD8RP3BS0U_g",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &#169; <a href="http://mapbox.com">Mapbox</a>',id:"kiezatlas.m7222ia5"}).addTo(f.map),f.map.on("locationfound",f.on_browser_location_found),f.map.on("locationerror",f.on_browser_location_error),f.map.on("dragend",f.on_map_drag_end),f.map.on("drag",f.on_map_drag),mapping.control_group.addTo(f.map),f.map.setView(f.get_current_location_coords(),mapping.zoom_kiez),f.map.on("zoomend",function(a){mapping.marker_radius_fixed||(f.map.getZoom()<=12?(mapping.marker_radius=7,mapping.marker_radius_selected=11):13===f.map.getZoom()?(mapping.marker_radius=9,mapping.marker_radius_selected=13):14===f.map.getZoom()?(mapping.marker_radius=11,mapping.marker_radius_selected=15):15===f.map.getZoom()?(mapping.marker_radius=12,mapping.marker_radius_selected=17):f.map.getZoom()>=16&&(mapping.marker_radius=14,mapping.marker_radius_selected=19),f.update_geo_object_marker_radius(),f.fire_zoom_end(a))})},f.fit_to_height=function(b){var c=window.innerHeight;b&&(c-=b),a("#"+f.elementId).height(c),f.map.invalidateSize()},f.set_zoom=function(a){f.map.setZoom(a)},f.clear_marker=function(){mapping.marker_group&&(mapping.marker_group.eachLayer(function(a){f.map.removeLayer(a)}),f.map.removeLayer(mapping.marker_group),mapping.marker_group=void 0)},f.render_circle_search_control=function(c){mapping.circle_search_control&&mapping.control_group.removeLayer(mapping.circle_search_control),f.is_circle_query_active()&&(mapping.circle_search_control=new b.CircleEditor(f.get_current_location_coords(),mapping.circle_search_radius,{color:colors.ka_gold,weight:3,opacity:.4,extendedIconClass:"extend-icon-medium",className:"leaflet-search-control",clickable:!1,zIndexOffset:101,fillColor:colors.ka_gold}),mapping.control_group.addLayer(mapping.circle_search_control),mapping.circle_search_control.on("edit",function(a){var b=a.target._mRadius;f.set_current_location_coords(a.target._latlng),f.fire_circle_edit(b)}),c&&f.map.fitBounds(mapping.control_group.getBounds(),{padding:[30,30]}),f.is_circle_control_fixed()&&a(".leaflet-editing-icon").hide())},f.remove_circle_search_control=function(){mapping.circle_search_control&&mapping.control_group.removeLayer(mapping.circle_search_control)},f.render_geo_objects=function(a){var c=[],d="id";f.is_angebote_mode()&&(d="location_id");var e=f.get_items();for(var g in e){var h=e[g];if("null"!==h&&h){if(!f.exist_marker_in_listing(h,c,d)){var i=f.create_geo_object_marker(h);i&&c.push(i)}}else console.warn("Skipping Geo Object View Model ["+g+"]",h)}mapping.marker_group&&mapping.marker_group.eachLayer(function(a){f.exist_marker_in_listing(a.options,c,d)||c.push(a)}),f.clear_marker(),mapping.do_cluster_marker?(mapping.marker_group=b.markerClusterGroup({spiderfyOnMaxZoom:!0,spiderfyDistanceMultiplier:2,showCoverageOnHover:!1,maxClusterRadius:60}),mapping.marker_group.addLayers(c),mapping.marker_group.on("clusterclick",function(a){console.log("Clusterclick",a)})):mapping.marker_group=b.featureGroup(c);for(var g in c){var j=c[g];mapping.marker_group.addLayer(j)}f.map.addLayer(mapping.marker_group),a&&c.length>0&&f.map.fitBounds(mapping.marker_group.getBounds(),{padding:[30,30]})},f.create_geo_object_marker=function(a){if(a.hasOwnProperty("latitude")&&a.hasOwnProperty("longitude")){console.log("creating geo object marker");var c=a;if(a.latitude>90||a.longitude>180||a.latitude<-90||a.longitude<-180)return void console.warn("Invalid WGS 84 coordinates spotted at",a);if(a.longitude<10||a.latitude<45||a.longitude>15||a.latitude>55)return void console.warn("WGS 84 coordinates do look strange in case of Berlin",a);if(""===a.bezirksregion_uri&&""===a.bezirk_uri)return void console.warn("Invalid Geo Object - Missing Bezirksregion & Bezirk URI",a.name);var d=b.latLng(c.latitude,c.longitude),e=b.circleMarker(d,f.calculate_default_circle_options(c));return e.setRadius(mapping.marker_radius),e.on("click",function(a){f.select_geo_object_marker(a.target)}),e.on("mouseover",function(a){e.setRadius(mapping.marker_radius+5),e.setStyle(f.calculate_hover_circle_options()),f.fire_marker_mouseover(a)}),e.on("mouseout",function(a){"selected"!==a.target.options.className&&(e.setRadius(mapping.marker_radius),e.setStyle(f.calculate_default_circle_options(c))),f.fire_marker_mouseout(a)}),e}return void console.warn("Could not geo object marker caused by missing geo coordinates")},f.update_geo_object_marker_radius=function(){mapping.marker_group&&mapping.marker_group.eachLayer(function(a){var b=a.options.id;b&&a.setRadius(mapping.marker_radius)})},f.highlight_geo_object_marker_by_id=function(a,b){mapping.marker_group.eachLayer(function(c){var d=c.options.id;if(d==a)mapping.do_cluster_marker||(c.setStyle(f.calculate_selected_circle_options()),c.bringToFront(),c.setRadius(mapping.marker_radius_selected)),b&&f.map.setView(c.getLatLng(),mapping.zoom_street);else{var e={name:c.options.name,bezirksregion_uri:c.options.bezirksregion_uri,uri:c.options.uri,angebote_count:c.options.angebote_count,angebots_id:c.options.angebots_id,id:d,address_id:c.options.address_id,location_id:c.options.location_id,address:c.options.address};c.setStyle(f.calculate_default_circle_options(e)),c.setRadius(mapping.marker_radius)}})},f.select_geo_object_marker=function(a){if(mapping.marker_group.eachLayer(function(a){var b=a.options.id;if(b){var c={name:a.options.name,bezirksregion_uri:a.options.bezirksregion_uri,uri:a.options.uri,angebote_count:a.options.angebote_count,angebots_id:a.options.angebots_id,id:b,address_id:a.options.address_id,location_id:a.options.location_id,address:a.options.address};a.setStyle(f.calculate_default_circle_options(c)),a.setRadius(mapping.marker_radius)}dummyObject=a.options}),a.setStyle(f.calculate_selected_circle_options()),a.bringToFront(),a.setRadius(mapping.marker_radius_selected),a.options.angebots_id)f.fire_angebot_marker_select(a);else{var b=f.find_all_geo_objects(a.options.address_id);f.fire_geo_marker_select(b)}},f.calculate_default_circle_options=function(a){var b=a.angebote_count>0,c=f.calculate_geo_object_dash_array(a),d=a.hasOwnProperty("angebots_id")?a.angebots_id:void 0;return{weight:b?3:2,opacity:b?1:.6,fillColor:b?colors.ka_red:colors.bright_grey,fillOpacity:b?.6:.2,lineCap:"square",dashArray:c,color:b?colors.ka_gold:colors.ka_red,title:a.name,alt:"Markierung von "+a.name,bezirk_uri:a.bezirk_uri,uri:a.uri,name:a.name,bezirksregion_uri:a.bezirksregion_uri,z_indexOffset:1001,uri:a.uri,angebote_count:a.angebote_count,angebots_id:d,address:a.address,id:a.id,address_id:a.address_id,location_id:a.location_id}},f.calculate_selected_circle_options=function(){return{color:colors.ka_gold,weight:3,opacity:1,fillColor:colors.ka_red,fillOpacity:1,className:"selected"}},f.calculate_hover_circle_options=function(){return{color:colors.ka_gold,weight:3,opacity:1,fillColor:colors.ka_red,fillOpacity:1,className:"hover"}},f.calculate_geo_object_dash_array=function(a){var b=a.angebote_count;return 0===b?[100]:1===b?[2,75]:2===b?[2,5,2,70]:3===b?[2,5,2,5,2,65]:4===b?[2,5,2,5,2,5,2,60]:5===b?[2,5,2,5,2,5,2,5,2,55]:6===b?[2,5,2,5,2,5,2,5,2,5,2,50]:7===b?[2,5,2,5,2,5,2,5,2,5,2,5,2,45]:8===b?[2,5,2,5,2,5,2,5,2,5,2,5,2,5,2,40]:9===b?[2,5,2,5,2,5,2,5,2,5,2,5,2,5,2,5,2,40]:b>9?[2,5]:void 0},f.is_initialized=function(){return!!f.map},f.deactivate_circle_control=function(){mapping.circle_query=!1},f.activate_circle_control=function(){mapping.circle_query=!0},f.set_circle_control_fixed=function(a){return mapping.circle_locked=a},f.is_circle_control_fixed=function(){return mapping.circle_locked},f.is_circle_query_active=function(){return mapping.circle_query},f.set_angebote_mode=function(a){mapping.angebote_mode=a},f.is_angebote_mode=function(){return mapping.angebote_mode},f.scroll_into_view=function(a){a?document.getElementById(a).scrollIntoView():document.getElementById(f.elementId).scrollIntoView()},f.set_items=function(a){g=a},f.get_items=function(){return g},f.get_circle_control_radius=function(){return mapping.circle_search_control?mapping.circle_search_control.getRadius():mapping.circle_search_radius},f.set_circle_control_radius=function(a){mapping.circle_search_radius?mapping.circle_search_radius=a:console.warn("Circle Search Control is curerntly INACTIVE")},f.get_circle_control_bounds=function(){return mapping.circle_search_control.getBounds()},f.set_map_center=function(a){return f.map.setView(a)},f.pan_to=function(a){return f.map.panTo(a)},f.get_map_center=function(){return f.map.getCenter()},f.get_map_viewport=function(){if(f.map)return{bounds:f.map.getBounds(),zoom:f.map.getZoom(),center:f.map.getCenter()}},f.set_map_fit_bounds=function(a){return f.map.fitBounds(a)},f.get_current_location=function(){return mapping.current_location},f.get_current_location_name=function(){return mapping.current_location.name},f.get_current_location_coords=function(){return mapping.current_location.coordinate},f.get_current_location_lat=function(){return mapping.current_location.coordinate.lat},f.get_current_location_lng=function(){return mapping.current_location.coordinate.lng},f.set_current_location=function(a){mapping.current_location=a},f.set_marker_radius=function(a){mapping.marker_radius=a},f.set_marker_fixed_radius=function(a){mapping.marker_radius_fixed=a},f.set_marker_selected_radius=function(a){mapping.marker_radius_selected=a},f.set_current_location_name=function(a){mapping.current_location.name=a},f.set_current_location_coords=function(a){mapping.current_location.coordinate=a},f.get_item_by_id=function(a){var b=f.get_items();for(var c in b){var d=b[c];if(d){if(d.id===a)return d}else console.warn("Geo Object View Model NOT in Map Items",d)}},f.find_all_geo_objects=function(a){var b=[];return a&&mapping.marker_group.eachLayer(function(c){c.options.address_id===a&&b.push(c)}),b},f.exist_marker_in_listing=function(a,b,c){if(b)for(var d in b){if(!a[c])return console.error("marker has no",c,"property",a),!1;if(b[d].options[c]===a[c])return!0}return!1},f.listen_to=function(a,b){var c=document.getElementById(f.elementId);c.addEventListener(a,b)},f.fire_drag_end=function(a){var b=document.getElementById(f.elementId);d(b,"drag_end",a.distance)},f.fire_zoom_end=function(a){var b=document.getElementById(f.elementId);d(b,"zoom_end",a)},f.fire_drag=function(){var a=document.getElementById(f.elementId);d(a,"drag")},f.fire_geo_marker_select=function(a){var b=document.getElementById(f.elementId);d(b,"marker_select",a)},f.fire_angebot_marker_select=function(a){var b=document.getElementById(f.elementId);d(b,"angebot_marker_select",a)},f.fire_marker_mouseover=function(a){var b=document.getElementById(f.elementId);d(b,"marker_mouseover",a)},f.fire_marker_mouseout=function(a){var b=document.getElementById(f.elementId);d(b,"marker_mouseout",a)},f.fire_circle_edit=function(a){var b=document.getElementById(f.elementId);d(b,"circle_control_edit",a)},f.fire_location_found=function(a){var b=document.getElementById(f.elementId);d(b,"locating_success",a)},f.fire_location_error=function(a){var b=document.getElementById(f.elementId);d(b,"locating_error",a)},f.on_map_drag=function(a){f.fire_drag()},f.on_map_drag_end=function(a){f.fire_drag_end(a)},f.on_browser_location_found=function(a){f.scroll_into_view(),mapping.max_bounds.contains([a.latitude,a.longitude])?f.fire_location_found({latitude:a.latitude,longitude:a.longitude}):c()},f.on_browser_location_error=function(a){f.scroll_into_view(),c()},f}($,L),favourites=function(a,b){function c(a){f.allDocs({include_docs:!0}).then(function(b){var c=parseInt(b.total_rows);a("place_"+c)}).catch(function(a){console.warn(a)})}function d(){var a=navigator.userAgent.indexOf("Trident")!=-1&&navigator.userAgent.indexOf("MSIE")==-1,b=navigator.userAgent.indexOf("MSIE")!=-1;return a||b}console.log("Favourites API Script loaded...");var e={},f=void 0;return e.is_available=function(){return!d()&&"undefined"!=typeof b},e.start_local_db=function(){e.is_available()?f=new b("kiezatlas_favourites"):console.log("Could not start PouchDB, possible we're on the MS IE")},e.list_entries_in_local_db=function(){f&&f.allDocs({include_docs:!0,descending:!0}).then(function(b){if(b.total_rows>0){a("#places .entries").empty();for(var c in b.rows){var d=b.rows[c];if("undefined"!=typeof d.doc.data){var e=a('<li class="ui-menu-item submenu-item"><a id="'+d.doc._id+'" href="#">'+d.doc.data.name+"</a></li>");e.click(function(a){f.get(a.target.id).then(function(a){kiezatlas.show_favourite_location(a.data)}).catch(function(a){console.warn(a)})}),a("#places .entries").append(e)}else console.warn("Uncorrect entry",d)}a("#places").menu({icons:{submenu:"ui-icon-grip-dotted-horizontal"}}),a("#places").show(),a("button.star").removeClass("no-favs")}}).catch(function(a){console.log(a)})},e.add_entry_to_local_db=function(a){f&&c(function(b){var c={_id:b,data:a};f.put(c),e.list_entries_in_local_db()})},e}($,PouchDB),angebote=function(a){var b={},c=[];return b.load_geo_objects_angebote=function(b){var d="",e=1;for(var f in b)d+=b[f],e<b.length&&(d+=";"),e++;a.ajax("/angebote/list/many/"+d,{type:"GET",error:function(a){console.warn("AJAX POST Error",a),200===a.status&&(c=response)},success:function(a){c=a}})},b.get_angebotsinfos_by_geo_object_id=function(a){var b=[];for(var d in c){var e=c[d];e.assoc.role_1.topic_id!==a&&e.assoc.role_2.topic_id!==a||b.push(e)}return b},b.show_angebotsinfos=function(c){var d=b.get_angebotsinfos_by_geo_object_id(c),e=a("#details-"+c+" .angebote-listing");0===e.children().length&&(e=a('<div class="angebote-listing">'),a(".angebote-link").append(e)),e.empty();for(var f in d){var g=d[f];console.log("- NYE - Render Angebotsinfo",g)}},b}($),settings={webapp_title:"Kiezatlas 2 Website",history_api_supported:window.history.pushState},updateURL=!0,query=void 0,parameter={page:void 0,viewport:void 0},selected_marker=void 0,month_names_de=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],colors={ka_blue:"#002856",ka_red:"#8f1414",m_blue:"#5784b8",ka_gold:"#EACA8F",bright_grey:"#a9a9a9",yellow:"#FFCC33",darkgrey:"#343434",blue:"#1944fc",b_blue:"#5a78f3",ka_water:"#ccdddd",grey:"#868686"},kiezatlas=function(a,b,c,d,e){var f={district:void 0,districts:[],locationsearch_results:[],autocomplete_item:0,view_angebote:!1,site_info:void 0,site_id:void 0,map_controls_results:!1};this.set_district=function(a){f.district=a},this.get_gistrict=function(){return f.district},this.set_site_info=function(a){f.site_info=a},this.set_site_id=function(a){f.site_id=a},this.get_site_info=function(){return f.site_info},this.get_site_id=function(){return f.site_id},this.set_districts=function(a){f.districts=a},this.get_districts=function(){return f.districts},this.set_frontpage_mode=function(){g.set_site_info(void 0),g.set_site_id(void 0)},this.set_angebotsfilter=function(a){f.view_angebote=a},this.set_mapcontrol_mode_results=function(){f.map_controls_results=!0,c.deactivate_circle_control(),c.remove_circle_search_control()},this.set_mapcontrol_mode_query=function(a){f.map_controls_results=!1,c.is_circle_query_active()?c.render_circle_search_control(a):(c.activate_circle_control(),c.render_circle_search_control(a),console.log("Activating circle query control..."))},this.is_kiezatlas_site=function(){return f.siteId},this.is_map_result_control=function(){return f.map_controls_results},this.is_map_query_control=function(){return!f.map_controls_results},this.is_angebote_mode=function(){return f.view_angebote};var g=this;return this.do_logout=function(){d.logout(),window.document.location.reload()},this.init_page_navigation=function(){settings.history_api_supported&&(window.onpopstate=function(a){if(a.state)if(parameter=a.state,"#gesamt"===parameter.page?parameter.viewport=a.state.viewport:"#angebote"===a.state.page||console.log("Pop Render Districts or Citymap Page",a.state),parameter.viewport){var b=L.latLng(parameter.viewport.center);c.set_zoom(parameter.viewport.zoom),c.pan_to(b),kiezatlas.is_map_query_control()&&(c.set_current_location_coords(b),c.activate_circle_control(),c.render_circle_search_control(),g.do_circle_search(),g.do_reverse_geocode())}else console.log("No Viewport Parameter")})},this.get_search_keywords=function(a){d.load_search_keywords(a,function(b){console.log("Loaded Search Keywords for ",a,"...",b)})},this.push_page_view=function(a){if(settings.history_api_supported){if(a&&parameter){var b=a+parameter.page;window.history.replaceState(parameter,settings.webapp_title,b)}}else console.warn("window.history manipulation not supported",window.navigator)},this.create_viewport_parameter=function(){var a=c.get_map_viewport(),b=void 0;return a&&(b="?koordinate="+a.center.lat.toFixed(5)+","+a.center.lng.toFixed(5)+"&zoomstufe="+a.zoom),b},this.update_page_parameter=function(){g.is_kiezatlas_site()?console.log("Kiezatlas Citymap",g.get_site_id(),g.get_site_info()):g.get_site_id()?console.log("Kiezatlas Website Mode",g.get_site_id(),g.get_site_info().value):g.is_map_result_control()&&query?g.is_angebote_mode()?parameter.page="#angebotssuche="+query:parameter.page="#ortssuche="+query:g.is_angebote_mode()?parameter.page="#angebote":parameter.page="#gesamt";var a=g.create_viewport_parameter();g.push_page_view(a)},this.get_map_viewport_from_url=function(){var a=window.location.search.indexOf("&zoomstufe="),b=void 0;a!==-1&&(b=window.location.search.slice(a+"&zoomstufe=".length));var c=window.location.search.indexOf("?koordinate="),d=void 0;if(c!==-1){var e=window.location.search.slice(c+"?koordinate=".length,a);d=L.latLng(e.split(","))}if(d||b)return{center:d,zoom:b}},this.get_page_parameter_from_url=function(){var a=g.get_map_viewport_from_url(),b=window.location.hash,c=0,d=-1;return window.location.hash.indexOf("?")!==-1&&(c=window.location.hash.indexOf("#"),d=window.location.hash.indexOf("?"),b=window.location.hash.slice(c,d)),{page:b,viewport:a}},this.render_page=function(a){if(a)g.render_gesamtstadtplan();else{parameter=g.get_page_parameter_from_url();var b=window.location.host.indexOf("mitte.")!==-1||window.location.hostname.indexOf("mitte.")!==-1,c=void 0;parameter.page?"#gesamt"===parameter.page?g.render_gesamtstadtplan():"#angebote"===parameter.page?g.show_angebote_page():parameter.page.indexOf("ssuche")!==-1?g.render_search_page():g.load_district_topics(function(){c=g.get_bezirks_topic_by_hash(parameter.page),c?g.render_bezirkspage(c):(g.render_gesamtstadtplan(),console.warn("Entschudligung, die Seite "+parameter.page+" konnte nicht geladen werden. "))}):b?g.load_district_topics(function(a){c=g.get_bezirks_topic_by_hash("#mitte"),g.render_bezirkspage(c)}):(console.log("Fallback to render Gesamtstadtplan caused by Page Name",a,"Anchor",parameter.page,"and unspecific Subdomain"),g.render_gesamtstadtplan())}},this.render_gesamtstadtplan=function(){parameter.page="#gesamt",parameter.viewport?(c.set_current_location_coords(parameter.viewport.center),g.render_map(!0,{zoom:parameter.viewport.zoom,center:parameter.viewport.center},!1)):g.render_map(!0,void 0,!1),g.load_district_topics(function(a){g.render_district_menu()})},this.render_search_page=function(){var b=window.location.hash;if(g.render_map(!1,{zoom:parameter.viewport.zoom,center:parameter.viewport.center},!0),g.load_district_topics(function(a){g.render_district_menu()}),parameter.page.indexOf("#angebotssuche")!==-1){var c=void 0;c=b.indexOf("?")!==-1?b.slice("#angebotssuche=".length,b.indexOf("?")):b.slice("#angebotssuche=".length),a("#fulltext-search").val(c),g.set_angebotsfilter(!0)}else if(parameter.page.indexOf("#ortssuche")!==-1){var c=void 0;c=b.indexOf("?")!==-1?b.slice("#ortssuche=".length,b.indexOf("?")):b.slice("#ortssuche=".length),a("#fulltext-search").val(c),g.set_angebotsfilter(!1)}g.set_mapcontrol_mode_results(),search_fulltext_geo_objects()},this.void=function(){},this.render_bezirkspage=function(a){a?(g.set_site_info(a),g.set_site_id(a.id),g.load_marker_cluster_scripts(),g.render_map(!1,parameter.viewport,!1,!0),g.show_district_page(g.get_site_info().id),g.render_district_menu(a)):console.error("Critical - could not render bezirkspage due to missing bezirkstopic")},this.render_kiezatlas_site=function(a){citymap.render_kiezatlas_site(a)},this.load_marker_cluster_scripts=function(){var a=document.createElement("link");a.setAttribute("href","/de.kiezatlas.website/vendor/leaflet/markercluster/dist/MarkerCluster.css"),a.setAttribute("rel","stylesheet");var b=document.createElement("link");b.setAttribute("href","/de.kiezatlas.website/vendor/leaflet/markercluster/dist/MarkerCluster.Default.css"),b.setAttribute("rel","stylesheet");var c=document.createElement("script");c.setAttribute("src","/de.kiezatlas.website/vendor/leaflet/markercluster/dist/leaflet.markercluster.js"),document.head.appendChild(a),document.head.appendChild(b),document.head.appendChild(c),mapping.do_cluster_marker=!0},this.render_map=function(a,b,d,e,f){c.is_initialized()||g.setup_map_area("map",e,f),d&&c.scroll_into_view(),a&&g.get_browser_location(),b&&(b.zoom&&c.set_zoom(b.zoom),b.center&&c.pan_to(b.center))},this.handle_bezirks_item_click=function(a){var b=a.target.getAttribute("href");if(0===b.indexOf("/")&&(b=b.substr(1)),"#gesamt"===b)g.clear_district_page(),g.render_page("gesamt");else{var c=g.get_bezirks_topic_by_hash(b);g.render_bezirkspage(c)}g.hide_sidebar()},this.hide_sidebar=function(){$sidebarUi&&$sidebarUi.sidebar("hide")},this.render_district_menu=function(b){var c=g.get_districts(),d=a("#bezirksauswahl");d.empty();var e=a('<a href="#gesamt" id="gesamt" class="item gesamt">Gesamtstadtplan</a>');e.click(g.handle_bezirks_item_click),b||e.addClass("active"),d.append(e);for(var f in c){var h=c[f],i="#"+encodeURIComponent(h.value.toLowerCase()),j=a('<a href="'+i+'" id="'+encodeURIComponent(h.value.toLowerCase())+'" class="item '+i+'">'+h.value+"</a>");b&&h.id===b.id&&j.addClass("active"),i.indexOf("marzahn")!==-1||i.indexOf("reinickendorf")!==-1||i.indexOf("pankow")!==-1?j.addClass("disabled"):j.click(g.handle_bezirks_item_click),
d.append(j)}},this.show_angebote_page=function(){g.is_angebote_mode()&&(query=void 0,a("#fulltext-search").val()),g.set_angebotsfilter(!0),g.render_map(!1,void 0,!1,!0),c.set_angebote_mode(!0),g.update_page_parameter(),g.set_fulltext_search_placeholder("Volltextsuche in Angeboten");var b=a("div.legende");0===b.children("a.circle-control").length?b.append('<a class="circle-control" href="javascript:kiezatlas.clear_angebote_page()">Einrichtungssuche</a>'):a("a.circle-control").show(),a("a.lock-control").hide(),a("a.district-control").hide(),a("span.angebote-btn").addClass("bold"),a("span.einrichtungen-btn").removeClass("bold"),g.set_mapcontrol_mode_results(),d.load_current_angebotsinfos(function(a){c.set_angebote_mode(!0),c.clear_marker(),c.set_items(a),c.render_geo_objects(!0)}),g.load_district_topics(function(a){g.render_district_menu()})},this.clear_angebote_page=function(){a("span.einrichtungen-btn").addClass("bold"),a("span.angebote-btn").removeClass("bold"),g.set_fulltext_search_placeholder("Volltextsuche Berlinweit"),a("a.circle-control").hide(),a("a.district-control").hide(),a("a.lock-control").show(),g.set_angebotsfilter(!1),c.set_angebote_mode(!1),c.set_current_location_coords(c.get_map_center()),c.map.setView(c.get_current_location_coords(),mapping.zoom_street),c.activate_circle_control(),c.render_circle_search_control(),g.do_circle_search(void 0,void 0),g.do_reverse_geocode(),g.update_page_parameter()},this.show_district_page=function(b){g.set_site_info(g.get_bezirks_topic_by_id(b));var e=g.get_site_info().html,f=g.get_site_info().value,h=g.get_site_info().newsfeed;a(".location-label .text").html("Berlin "+f),a(".top.menu a.star").hide(),0===a("div.legende").children("a.district-control").length&&a("div.legende").append('<a class="district-control" href="javascript:kiezatlas.clear_district_page()">Bezirksfilter aufheben</a>'),g.set_fulltext_search_placeholder("Volltextsuche für "+f),a("a.lock-control").hide(),a("a.circle-control").hide(),a("#site-area").show("flex"),a("#site-area .content-area").html(e+'<br/><a href="'+g.get_site_info().imprint+'">Impressum</a>'),c.scroll_into_view(),g.set_mapcontrol_mode_results(),g.show_message("Die Volltextsuche liefert ab jetzt nur Ergebnisse aus dem Bezirk <em>"+f+"</em>. W&auml;hlen sie <em>Bezirksfilter aufheben</em> um wieder Berlinweit Einrichtungen zu finden.",7e3),g.update_document_title(void 0,f),g.show_spinning_wheel(),g.show_newsfeed_area(b,h),d.load_district_topics(b,function(a){c.clear_marker(),g.hide_spinning_wheel(),c.set_items(a),parameter.viewport?c.render_geo_objects(!1):c.render_geo_objects(!0)})},this.show_newsfeed_area=function(b,c){d.load_news_items(b,function(b){var d;if(b)if(b.length>0){d="<h2>Neuigkeiten</h2>";for(var e in b)d+='<div class="news-item"><span class="label date">'+g.format_date(b[e].published)+"</span><h3>"+b[e].title+'&nbsp;<a href="'+b[e].link+'" target="_blank">mehr Infos</a></h3></div>'}else d="<h2>Entschuldigen Sie bitte</h2>",d+='<div class="news-item">Der Newsfeed f&uuml;r diese Site (<a target="_blank" href="'+c+'">Link</a>) konnte gerade nicht geladen werden.</div>';else a("#site-area .news-area").hide();a("#site-area .news-area").html(d)})},this.clear_district_page=function(){a("#site-area").hide(),g.clear_district_filter(),mapping.do_cluster_marker=!1,c.set_current_location_coords(c.get_map_center()),g.set_mapcontrol_mode_query(!0),c.set_zoom(mapping.zoom_kiez),g.do_circle_search(void 0,void 0),g.do_reverse_geocode()},this.clear_district_filter=function(){g.set_frontpage_mode(),g.set_fulltext_search_placeholder("Volltextsuche Berlinweit"),a("a.district-control").remove(),a("a.lock-control").show(),c.scroll_into_view()},this.show_favourite_location=function(a){c.is_initialized()||g.setup_map_area("map"),c.set_current_location(a),c.map.setView(c.get_current_location_coords(),mapping.zoom_street),c.activate_circle_control(),c.render_circle_search_control(),g.do_circle_search(void 0,void 0),g.render_current_location_label()},this.setup_map_area=function(b,d,e){var f=!1,h=a("#map");h.empty(),h.show();var i=a(".top.menu a.star");i.show(),a(".search-option.d").css("display","inline-block"),a("#detail-area").show("inline"),a("div.legende").show(),c.setup(b,d),c.listen_to("drag",function(a){c.is_circle_control_fixed()&&g.is_map_query_control()&&(c.set_current_location_coords(c.get_map_center()),c.set_circle_control_radius(c.get_circle_control_radius()),c.activate_circle_control(),c.render_circle_search_control(!1))}),c.listen_to("zoom_end",function(a){g.update_page_parameter()}),c.listen_to("drag_end",function(a){a.detail>=8&&c.is_circle_query_active()&&c.is_circle_control_fixed()&&!g.is_kiezatlas_site()&&g.is_map_query_control()&&(g.do_circle_search(void 0,void 0),g.do_reverse_geocode()),f=!0,g.update_page_parameter()}),c.listen_to("marker_select",function(a){g.clear_details_area(),g.show_selected_geo_details(a.detail),f=!0,selected_marker=a}),c.listen_to("angebot_marker_select",function(a){g.clear_details_area();var b=c.find_all_geo_objects(a.detail.options.address_id);g.show_selected_angebot_detail(a.detail,b),f=!0,selected_marker=a}),c.listen_to("marker_mouseover",function(a){var b=c.find_all_geo_objects(a.detail.target.options.address_id);g.show_marker_name_info(b)}),c.listen_to("marker_mouseout",function(a){g.hide_marker_name_info()}),c.listen_to("circle_control_edit",function(a){c.set_circle_control_radius(a.detail),g.do_circle_search(c.get_current_location_coords(),a.detail),g.do_reverse_geocode(),f=!0}),c.listen_to("locating_success",function(a){console.info("location success by browser",window.navigator),f?console.log("Skip locatiing_error as user already interacted with the map",a):(c.set_current_location_coords(new L.latLng(a.detail.latitude,a.detail.longitude)),c.activate_circle_control(),c.render_circle_search_control(),g.do_circle_search(c.get_current_location_coords(),void 0),g.do_reverse_geocode(),g.update_page_parameter())}),c.listen_to("locating_error",function(a){f?console.log("Skip locatiing_error as user already interacted with the map",a):(console.warn("locating error detected by browser",window.navigator),c.render_circle_search_control(),g.render_current_location_label(),g.do_circle_search(void 0,void 0),g.do_reverse_geocode())}),g.render_browser_location_button(),g.render_current_location_label(),e||c.render_circle_search_control()},this.focus_locationsearch_result=function(){var a=f.locationsearch_results[f.autocomplete_item];if(!a)throw new Error("Autocomplete item is undefined",a,f.autocomplete_item);mapping.max_bounds.contains([a.geometry.location.lat,a.geometry.location.lng])?(c.scroll_into_view(),c.set_current_location_coords(new L.latLng(a.geometry.location.lat,a.geometry.location.lng)),c.set_circle_control_radius(900),c.set_current_location_name(a.formatted_address),c.activate_circle_control(),c.render_circle_search_control(),c.map.panTo(c.get_current_location_coords()),g.render_current_location_label(),g.do_circle_search(void 0,void 0)):(c.set_current_location_name("Der erste gefundene Standort liegt au&szlig;erhalb von Berlin, bitte w&auml;hlen sie eine der Alternativen rechts:"),g.render_current_location_label(!0),c.scroll_into_view(),c.map.setView(c.get_current_location_coords(),mapping.zoom_street))},this.show_locationsearch_alternatives=function(){var b=f.locationsearch_results[f.autocomplete_item-1],c=f.locationsearch_results[f.autocomplete_item+1],d="",e="";b?(d=a('<a class="prev-location" title="'+b.formatted_address+'"><</a>'),d.click(function(a){f.autocomplete_item=f.autocomplete_item-1,g.focus_locationsearch_result(),g.show_locationsearch_alternatives()})):d=a('<a class="prev-location defused" title=""><</a>'),c?(e=a('<a class="next-location" title="'+c.formatted_address+'">></a>'),e.click(function(a){f.autocomplete_item=f.autocomplete_item+1,g.focus_locationsearch_result(),g.show_locationsearch_alternatives()})):e=a('<a class="next-location defused" title="">></a>'),a("#street-alternatives").html(f.locationsearch_results.length+" Ergebnisse").append(d).append(e),a("#street-alternatives").css("display","inline-block"),a("#street-alternatives").show()},this.render_current_location_label=function(b){var d=c.get_current_location();d.hasOwnProperty("name")||console.warn("Current location has no name"),d.coordinate.hasOwnProperty("lat")||console.warn("Current location has no lat"),d.coordinate.hasOwnProperty("lng")||console.warn("Current location has no lng");var f,h;if(f=c.get_current_location_lat().toFixed(3),h=c.get_current_location_lng().toFixed(3),a(".location-label .text").html(c.get_current_location_name()+" <small>("+f+" N, "+h+" E)</small>"),e.is_available()){var i=a(".top.menu a.star");i.unbind("click"),i.click(function(a){e.add_entry_to_local_db(c.get_current_location())}),b?i.hide():i.show()}var j=c.get_current_location_name();j.indexOf("Ihr Standort liegt")===-1&&g.update_document_title(c.get_current_location_name())},this.show_selected_geo_details=function(a){var b=[];for(var c in a){var e=a[c].options,f=e.id;b.push(f),d.load_geo_object_detail(f,function(a){g.render_selected_details_card(a)})}},this.show_selected_angebot_detail=function(a,b){var c=a.options,e={id:c.location_id,name:c.name,address:c.address};d.load_related_angebotsinfos(c.location_id,function(a){g.render_selected_angebot_details_card(a,e)})},this.render_selected_angebot_details_card=function(b,c){var d="";for(var e in b){var f=b[e];d+='<p><a class="ui button olive" href="/angebote/'+f.angebots_id+'" title="mehr Infos zum Angebot">'+f.angebots_name+" ...</a></p>"}a("#detail-area").append('<div class="entry-card" id="details-'+c.id+'"><h3>'+c.name+'</h3><div class="details angebote"><p>'+cleanUpAddress(c.address)+'</p><p class="label">Aktuell '+b.length+" Angebot/e</p>"+d+"</div></div>")},this.render_selected_details_card=function(b){var c=g.get_imprint_html(b),d=b.kontakt,e=b.oeffnungszeiten,f=g.get_lor_link(b),h='<a href="https://fahrinfo.bvg.de/Fahrinfo/bin/query.bin/dn?Z='+b.address_name.toString()+'&REQ0JourneyStopsZA1=2&start=1&pk_campaign=kiezatlas.de"><img src="/de.kiezatlas.website/images/fahrinfo.gif"></a>',i="";b.angebote_count>0&&(i='<div class="angebote-link"><a class="button" href="/website/geo/'+b.id+'">Aktuelle Angebote anzeigen</a></div>'),g.get_site_info()&&!g.get_site_info().fahrinfoLink&&(h="",console.log("Fahrinfo Link Disabled"));var j="";if("undefined"!=typeof d&&d.value.length>0){var k="<br/>";d.childs.hasOwnProperty("ka2.kontakt.telefon")&&d.childs["ka2.kontakt.telefon"].value.length>0&&(k+="Tel.: "+d.childs["ka2.kontakt.telefon"].value+"<br/>"),d.childs.hasOwnProperty("ka2.kontakt.fax")&&d.childs["ka2.kontakt.fax"].value.length>0&&(k+="Fax: "+d.childs["ka2.kontakt.fax"].value),j+="<p><b>Kontakt</b> "+k+"</p>"}"undefined"!=typeof e&&e.length>0&&(j+="<p><b>&Ouml;ffnungszeiten</b>"+e+"</p>");var l=b.unconfirmed?" unconfirmed":"";a("#detail-area").append('<div class="entry-card'+l+'" id="details-'+b.id+'"><h3>'+b.name+'</h3><div class="details"><p>'+b.address_name.toString()+"<br/>"+j+"</p>"+i+'<a href="/website/geo/'+b.id+'" title="Zeige Details" class="ui button olive">mehr Infos</a>'+h+"</div>"+f+c+"</div>")},this.load_district_topics=function(a){d.load_districts(function(b){g.set_districts(b.sort(d.value_sort_asc)),a&&a()})},this.show_district_listing=function(){var b=g.get_districts();for(var c in b){var d=b[c],e='<li class="bezirk '+d.uri+'">';e+='<a class="district-button" id="'+d.id+'" title="zur Bezirksseite '+d.value+'" href="javascript:kiezatlas.show_district_page('+d.id+')">'+d.value+"</a>",e+="</li>";var f=a(e);a("ul.bezirke").append(f)}},this.create_location_string=function(a){var b="";return b=a?a.lng.toFixed(4)+", "+a.lat.toFixed(4):c.get_current_location_lng()+", "+c.get_current_location_lat()},this.do_circle_search=function(b,d){g.show_spinning_wheel(),g.set_mapcontrol_mode_query();var e=g.create_location_string(b),f=d;d||(f=c.get_circle_control_radius()),a.getJSON("/website/search/"+encodeURIComponent(e)+"/"+f/1e3,function(a){a.length>0?(c.set_items(a),c.clear_marker(),c.render_geo_objects(!1)):g.show_message("Keine Treffer in diesem Umkreis",2e3),g.hide_spinning_wheel()})},this.do_text_search_geo_objects=function(b,d,e){g.set_mapcontrol_mode_results();var f="/website/search/?search="+b;g.get_site_id()&&(f="/website/search/"+g.get_site_id()+"/?search="+b),g.show_searching_indicator(),g.show_spinning_wheel(),a("span.einrichtungen-btn").addClass("bold"),a("span.angebote-btn").removeClass("bold"),a.getJSON(f,function(a){a.length>0?(c.set_items(a),c.clear_marker(),e?c.render_geo_objects(!0):c.render_geo_objects(!1),g.hide_spinning_wheel(),g.hide_searching_indicator()):(g.hide_spinning_wheel(),g.hide_searching_indicator(),g.show_message("Keine Treffer f&uuml;r diese Suche")),d&&d(a)}),updateURL&&g.update_page_parameter()},this.do_text_search_angebotsinfos=function(b,d){var e="/website/search/angebote?search="+b;g.set_mapcontrol_mode_results(),g.show_spinning_wheel(),a.getJSON(e,function(a){a.length>0?(c.set_items(a),c.clear_marker(),d?c.render_geo_objects(!0):c.render_geo_objects(!1),g.hide_spinning_wheel()):(g.hide_spinning_wheel(),g.show_message("Keine Treffer f&uuml;r diese Suche"))}),updateURL&&g.update_page_parameter()},this.do_reverse_geocode=function(a){d.do_reverse_geocode(c,g)},this.toggle_circle_search_lock_button=function(b){var d=!c.is_circle_control_fixed();c.set_circle_control_fixed(d),d?(g.is_angebote_mode()&&g.clear_angebote_page(),a(".lock-control").text("Umkreissuche"),a(".leaflet-editing-icon").hide()):(a(".leaflet-editing-icon").show(),a(".lock-control").text("Kreis fixieren"))},this.toggle_location_menu=function(b){return b?void a("#nearby-area .options").show():void a("#nearby-area .options").toggle()},this.add_page_input_handler=function(){function b(a){g.render_map(!0,void 0,!0,!0)}a(".sidebar .bezirke .menu a").click(g.handle_bezirks_item_click);var c=a(".search-option.a");c.on("touchend",b),c.on("click",b);var d=a(".search-option.b");d.on("touchend",g.focus_location_input_field),d.on("click",g.focus_location_input_field);var e=a(".search-option.c");e.on("touchend",g.handle_option_c),e.on("click",g.handle_option_c)},this.handle_option_c=function(a){g.render_map(!1,{zoom:mapping.zoom_kiez},!0,!0)},this.handle_option_b=function(a){g.render_map(!1,{zoom:mapping.zoom_street},!0,!0)},this.set_fulltext_search_placeholder=function(b){a("#fulltext-search").attr("placeholder",b)},this.get_fulltext_search_input=function(){return a("#fulltext-search").val()},this.get_top_search_input=function(){return a("#text-search").val()},this.show_marker_name_info=function(b){var c="",d=4;for(var e in b)if(c+="<b>"+b[e].options.name+"</b><br/>",e===d){c+="...";break}var f=a("#marker-name","#map");f.children().length>0?(f.html(c),f.show()):(f=a('<div id="marker-name">'),f.html(c),a("#map").append(f),f.show())},this.hide_marker_name_info=function(){a("#marker-name","#map").hide()},this.focus_location_input_field=function(){g.toggle_location_menu(!0),a("#location-input #near-by").focus()},this.show_spinning_wheel=function(b){b?a("#location-input .spinning-wheel").show():a("#spinning-wheel").show()},this.hide_searching_indicator=function(){a(".ui.search button .icon").removeClass("loading").removeClass("circle").removeClass("notched"),a(".ui.search button .icon").addClass("search")},this.show_searching_indicator=function(){a(".ui.search button .icon").addClass("loading").addClass("circle").addClass("notched"),a(".ui.search button .icon").removeClass("search")},this.hide_spinning_wheel=function(b){b?a("#location-input .spinning-wheel").hide():"none"!==a("#spinning-wheel").css("display")&&a("#spinning-wheel").hide()},this.show_message=function(b,c){a("#notification").show(200,"linear",function(d){b&&a(".message",this).html(b),timer=c?c:4500,setTimeout(function(a){g.hide_message_window(500)},timer)})},this.close_message_window=function(){g.hide_message_window(100)},this.hide_message_window=function(b){a("#notification").hide(b,"linear")},this.render_browser_location_button=function(){var b='<a class="leaflet-control-zoom-loc" href="#" title="Your Location"></a>';a(b).insertBefore(".leaflet-control-zoom-in"),a(".leaflet-control-zoom-loc").click(g.get_browser_location)},this.clear_details_area=function(){a(".search-option.d").remove();var b=a(".entry-card");b.hide(200,"linear",function(){b.remove()})},this.get_browser_location=function(a){navigator.geolocation?("undefined"==typeof a&&(a={setView:!0,maxZoom:mapping.zoom_detail,enableHighAccuracy:!0}),c.map.locate(a)):console.warn("Geolocation is not supported by your browser")},this.get_imprint_html=function(a){var b=g.get_bezirks_topic(a.bezirk_uri),c='<div class="imprint">';return b?c+='<a href="'+b.imprint+'" target="_blank" title="Impressum: Bezirksamt '+b.value+'">Impressum</a></div>':(console.warn("Could not fetch Bezirks Topic by URI",b,a),c+="</div>"),c},this.get_lor_link=function(a){if(!a.hasOwnProperty("lor_id"))return"";var b='<div class="lor-link"><a href="http://sozialraumdaten.kiezatlas.de/seiten/2017/06/?lor='+a.lor_id+'" title="zur Einwohnerstatistik des Raums (LOR Nr. '+a.lor_id+')">Sozialraumdaten</a></div>';return b},this.update_document_title=function(a,b){a&&(window.document.title=a+" - "+settings.webapp_title),b&&(window.document.title=settings.webapp_title+" - "+b)},this.name_sort_asc=function(a,b){var c=a.name,d=b.name;return c.toLowerCase()>d.toLowerCase()?1:c.toLowerCase()<d.toLowerCase()?-1:0},this.get_current_location=function(){return c.get_current_location()},this.get_bezirks_topic=function(a){for(var b in g.get_districts()){var c=g.get_districts()[b];if(c.uri===a)return c}},this.get_bezirks_topic_by_id=function(a){for(var b in g.get_districts())if(g.get_districts()[b].id===a)return g.get_districts()[b]},this.get_bezirks_topic_by_hash=function(a){for(var b in g.get_districts()){var c=g.get_districts()[b],d="#"+encodeURIComponent(c.value.toLowerCase());if(d===a)return c}},this.set_autocomplete_item=function(a){f.autocomplete_item=a},this.get_autocomplete_item=function(){return f.autocomplete_item},this.set_locationsearch_results=function(a){f.locationsearch_results=a},this.get_locationsearch_results=function(){return f.locationsearch_results},this.format_date=function(a){try{var b=new Date(a),c=b.getMinutes()<10?"0"+b.getMinutes():b.getMinutes(),d=(b.getHours()<10?"0"+b.getHours():b.getHours(),""+b.getDate()+"."+month_names_de[b.getMonth()]+" "+b.getFullYear()+", "+b.getHours()+":"+c+" Uhr");return d}catch(a){throw Error(a)}},this}($,angebote,leafletMap,restc,favourites),DATA_TOPIC_ID="data-topic-id",display_map=!1,facetTypeDefs=void 0,citymap={init:function(a,b){display_map=!b,js.remove_cookie("dm4_topicmap_id"),citymap.setup_map_area("map",!0),kiezatlas.show_spinning_wheel(),leafletMap.zoom.setPosition("topleft"),leafletMap.deactivate_circle_control(),leafletMap.remove_circle_search_control(),a.indexOf("stadtteil")!==-1&&(leafletMap.set_marker_radius(10),leafletMap.set_marker_selected_radius(15),leafletMap.set_marker_fixed_radius(!0)),restc.load_website_info(a,function(a){kiezatlas.set_site_id(a.id),kiezatlas.set_site_info(a),kiezatlas.update_document_title(a.value),citymap.render_criteria_menu(a.criterias),a.markercluster&&(console.log("Do Use Markercluster"),kiezatlas.load_marker_cluster_scripts()),a.locationPrompt&&console.log("Do Location Prompt"),a.locationSearch&&console.log("Enable Location Search"),a.fahrinfoLink&&console.log("Render Fahrinfo Link"),citymap.render_info_area(a),kiezatlas.show_newsfeed_area(a.id,a.newsfeed),restc.load_website_geoobjects(a.id,function(a){kiezatlas.hide_spinning_wheel(),leafletMap.set_items(a),leafletMap.render_geo_objects(!0)}),restc.load_website_facets(a.id,function(a){facetTypeDefs=a})})},setup_map_area:function(a,b){var c=$("#map");c.empty(),c.show();var d=$(".top.menu a.star");d.show(),$(".search-option.d").css("display","inline-block"),$("#detail-area").show("inline"),$("div.legende").show(),leafletMap.setup(a,b),leafletMap.listen_to("drag",function(a){leafletMap.is_circle_control_fixed()&&kiezatlas.is_map_query_control()&&(leafletMap.set_current_location_coords(leafletMap.get_map_center()),leafletMap.set_circle_control_radius(leafletMap.get_circle_control_radius()),leafletMap.render_circle_search_control(!1))}),leafletMap.listen_to("drag_end",function(a){a.detail>=8&&leafletMap.is_circle_query_active()&&leafletMap.is_circle_control_fixed()&&kiezatlas.is_map_query_control()&&(kiezatlas.do_circle_search(void 0,void 0),kiezatlas.do_reverse_geocode())}),leafletMap.listen_to("marker_select",function(a){citymap.clear_details_area(),citymap.show_selected_details(a.detail)}),leafletMap.listen_to("marker_mouseover",function(a){var b=leafletMap.find_all_geo_objects(a.detail.target.options.location_id);kiezatlas.show_marker_name_info(b)}),leafletMap.listen_to("marker_mouseout",function(a){kiezatlas.hide_marker_name_info()}),leafletMap.listen_to("circle_control_edit",function(a){kiezatlas.do_circle_search(leafletMap.get_current_location_coords(),a.detail),kiezatlas.do_reverse_geocode()}),leafletMap.listen_to("locating_success",function(a){leafletMap.set_current_location_coords(new L.latLng(a.detail.latitude,a.detail.longitude)),leafletMap.activate_circle_control(),leafletMap.render_circle_search_control(),kiezatlas.do_circle_search(leafletMap.get_current_location_coords(),void 0),leafletMap.set_map_fit_bounds(leafletMap.get_circle_control_bounds()),kiezatlas.do_reverse_geocode()}),leafletMap.listen_to("locating_error",function(a){leafletMap.render_circle_search_control(),kiezatlas.render_current_location_label(),kiezatlas.do_circle_search(void 0,void 0),kiezatlas.do_reverse_geocode()}),kiezatlas.render_browser_location_button(),kiezatlas.render_current_location_label(),leafletMap.render_circle_search_control()},render_mobile:function(){citymap.clear_and_select_places_tab();var a=leafletMap.get_items();for(var b in a)citymap.render_mobile_details_card(a[b]);$("#detail-area .mobile-load").hide()},render_mobile_details_card:function(a){var b=a.unconfirmed?" unconfirmed":"";$("#detail-area").append('<div class="entry-card'+b+'" id="details-'+a.id+'"><h3>'+a.name+'</h3><div class="details"><p>'+a.anschrift+'<br/></p><a href="javascript:citymap.show_selected_detail('+a.id+', false)" title="Zeige Details">mehr Infos</a><a href="https://fahrinfo.bvg.de/Fahrinfo/bin/query.bin/dn?Z='+encodeURIComponent(a.anschrift)+'&REQ0JourneyStopsZA1=2&start=1&pk_campaign=kiezatlas.de"><img src="/de.kiezatlas.website/images/fahrinfo.gif"></a></div></div>'),$("#detail-area .mobile-load").show()},show_selected_details:function(a){var b=[];for(var c in a){var d=a[c].options.id;b.push(d),citymap.show_selected_detail(d,!1)}},clear_and_select_places_tab:function(){$(".tabular.menu .item").tab("change tab","first"),$("#detail-area .search-option.d").remove(),$("#detail-area .entry-card").remove()},show_selected_detail:function(a,b){citymap.clear_and_select_places_tab(),leafletMap.highlight_geo_object_marker_by_id(a,b),restc.load_geo_object_detail(a,function(b){citymap.render_selected_detail(b),restc.load_facetted_geo_object(a,kiezatlas.get_site_id(),function(a){citymap.render_geo_object_facets(a)})})},clear_details_area:function(){$(".search-option.d").remove();var a=$(".entry-card");a.hide(200,"linear",function(){a.remove()})},render_selected_detail:function(a){var b=a.kontakt,c=kiezatlas.get_lor_link(a),d='<a href="https://fahrinfo.bvg.de/Fahrinfo/bin/query.bin/dn?Z='+a.address_name.toString()+'&REQ0JourneyStopsZA1=2&start=1&pk_campaign=kiezatlas.de"><img src="/de.kiezatlas.website/images/fahrinfo.gif"></a>',e="";a.angebote_count>0&&(e='<div class="angebote-link"><a class="button" href="/website/geo/'+a.id+'">Aktuelle Angebote anzeigen</a></div>'),kiezatlas.get_site_info()&&!kiezatlas.get_site_info().fahrinfoLink&&(d="");var f="";if("undefined"!=typeof b&&b.value.length>0){var g="<br/>";b.childs.hasOwnProperty("ka2.kontakt.telefon")&&b.childs["ka2.kontakt.telefon"].value.length>0&&(g+="Tel.: "+b.childs["ka2.kontakt.telefon"].value+"<br/>"),b.childs.hasOwnProperty("ka2.kontakt.fax")&&b.childs["ka2.kontakt.fax"].value.length>0&&(g+="Fax: "+b.childs["ka2.kontakt.fax"].value),f+="<p><b>Kontakt</b>"+g+"</p>"}var h=a.unconfirmed?" unconfirmed":"";$("#detail-area").append('<div class="entry-card'+h+'" id="details-'+a.id+'"><h3>'+a.name+'</h3><div class="details"><p>'+a.address_name.toString()+"<br/>"+f+"</p>"+e+'<div class="facets"></div>'+d+"</div>"+c+"</div>")},render_geo_object_facets:function(a){if(!facetTypeDefs)return void console.warn("Could not load facetTypeDefs",facetTypeDefs);var b=$("#details-"+a.id+" .facets");for(var c in facetTypeDefs){var d=facetTypeDefs[c],e=citymap.get_first_child_type_uri(d),f=d.assoc_defs[0].type_uri,g=d.assoc_defs[0].child_cardinality_uri,h=a.childs[e],i=d.value.indexOf(" Facet")!=-1?d.value.replace(" Facet",""):d.value,j=$('<div class="facet">'+i+"</div>"),k=$('<div class="facet-values">'),l=$('<span class="values">'),m=!0;if(f.indexOf("composition_def")!==-1)g.indexOf("many")!==-1?h.length>0?(l=$('<span class="composition-def-many values">'),h[0]&&l.html(h[0].value)):m=!1:h?(l=$('<span class="composition-def-one values">'),i.indexOf("Link")!==-1&&h.value.indexOf("http")!==-1?l.html('<a target="_blank" href="'+h.value+'">'+h.value+"</a>"):l.html(h.value)):m=!1;else if(f.indexOf("aggregation_def")!==-1)if(g.indexOf("many")!==-1){l=$('<ul class="aggregated-def-many values" id="'+d.uri+'">');for(var c in h){var n=h[c],o=$("<li>"+n.value+"</li>");l.append(o)}0===h.length&&(m=!1)}else l=$('<ul class="aggregated-def-one values" id="'+d.uri+'">'),h?l.append($("<li>"+h.value+"</li>")):m=!1;m&&(k.append(l),j.append(k),b.append(j))}},get_first_child_type_uri:function(a){var b=a.assoc_defs[0];return"dm4.core.child_type"===b.role_2.role_type_uri?b.role_2.topic_uri:b.role_1.topic_uri},render_info_area:function(a){$(".citymap-title").text(a.value),$(".welcome .title").text(a.value),$(".welcome .slogan").text(""),$("#sidebar .imprint").html('<a href="'+a.imprint+'" target="_blank">Impressum</a>'),$(".welcome .logo").attr("src",a.logo).attr("title","Logo "+a.value),$("#sidebar .content-area").html(a.html)},do_citymap_fulltext_search:function(a){kiezatlas.do_text_search_geo_objects(a.trim(),function(a){hide_loading_indicator(),0===$(".tabular.menu #search-tab").length&&$(".tabular.menu").append('<div id="search-tab" class="item" data-tab="third">Suche</div>'),$(".tabular.menu .item").tab("change tab","third");var b=$("#search-area ul.results");a.length>0&&b.empty();for(var c in a){var d=a[c],e=create_list_item(d);e.click(function(a){var b=a.target.getAttribute(DATA_TOPIC_ID);b||(b=a.delegateTarget.getAttribute(DATA_TOPIC_ID)),citymap.show_selected_detail(b,!0)}),b.append(e)}}),show_loading_indicator()},select_criteria:function(a,b){0===$(".tabular.menu #category-tab").length&&$(".tabular.menu").append('<div id="category-tab" class="item" data-tab="fourth">Kategorien</div>'),$("#category-area .title.criteria").text(a),$("#category-area .title.criteria").attr(DATA_TOPIC_ID,b),$("#category-area .title.criteria").unbind("click"),$("#category-area .title.criteria").bind("click",function(c){citymap.select_criteria(a,b)}),$(".tabular.menu .item").tab("change tab","fourth");var c=$("#category-area ul.results");c.removeClass("cats"),c.empty(),restc.load_topics_by_type(b,function(a){for(var b in a){var d=a[b],e=$('<li id="'+d.id+'" data-topic-id="'+d.id+'"><span class="label" data-topic-id="'+d.id+'">'+d.value+"</span></li>");e.click(function(a){var b=a.target.getAttribute(DATA_TOPIC_ID);citymap.select_category(b)}),c.append(e)}})},select_category:function(a){restc.load_geo_objects_by_category(kiezatlas.get_site_id(),a,function(b){var c=$("#category-area ul.results");if(b.length>0){c.addClass("cats"),c.empty();for(var d in b){var e=b[d],f=create_list_item(e);f.click(function(a){var b=a.target.getAttribute(DATA_TOPIC_ID);b||(b=a.delegateTarget.getAttribute(DATA_TOPIC_ID)),citymap.show_selected_detail(b,!0)}),c.append(f)}}else $("#"+a).append('<span class="status">(Keine Treffer)</span>')})},register_page_handlers:function(){$(window).resize(function(){setTimeout(function(){leafletMap.fit_to_height(65),citymap.set_sidebar_height()},50)}),$(".citymap .ui.search input").keyup(function(a){a.target.value.length>=3&&13===a.keyCode&&citymap.do_citymap_fulltext_search(a.target.value)}),$(".citymap .ui.search button").click(function(a){var b=$(".citymap .ui.search input").val();b.length>=3&&citymap.do_citymap_fulltext_search(b)}),leafletMap.listen_to("marker_select",function(a){$(".tabular.menu .item").tab("change tab","first")}),$(".tabular.menu .item").tab()},render_criteria_menu:function(a){var b=$(".criterias");b.empty();var c=$('<ul class="items">');b.append(c);for(var d in a){var e=a[d],f=$("<li>"),g=$('<a id="'+e.uri+'" href="#crit-'+e.id+'">'+e.value+"</a>");g.click(function(a){console.log("Selected Criteria",a.target.text,a.target.id),citymap.select_criteria(a.target.text,a.target.id)}),c.append(f.append(g))}},set_sidebar_height:function(){"none"===$("#karte").css("display")?$("#sidebar").height(window.innerHeight-4):$("#sidebar").height(window.innerHeight-36)}};!function(a,b,c,d){"use strict";b="undefined"!=typeof b&&b.Math==Math?b:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),a.fn.sidebar=function(e){var f,g=a(this),h=a(b),i=a(c),j=a("html"),k=a("head"),l=g.selector||"",m=(new Date).getTime(),n=[],o=arguments[0],p="string"==typeof o,q=[].slice.call(arguments,1),r=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.msRequestAnimationFrame||function(a){setTimeout(a,0)};return g.each(function(){var g,s,t,u,v,w,x=a.isPlainObject(e)?a.extend(!0,{},a.fn.sidebar.settings,e):a.extend({},a.fn.sidebar.settings),y=x.selector,z=x.className,A=x.namespace,B=x.regExp,C=x.error,D="."+A,E="module-"+A,F=a(this),G=a(x.context),H=F.children(y.sidebar),I=G.children(y.fixed),J=G.children(y.pusher),K=this,L=F.data(E);w={initialize:function(){w.debug("Initializing sidebar",e),w.create.id(),v=w.get.transitionEvent(),w.is.ios()&&w.set.ios(),x.delaySetup?r(w.setup.layout):w.setup.layout(),r(function(){w.setup.cache()}),w.instantiate()},instantiate:function(){w.verbose("Storing instance of module",w),L=w,F.data(E,w)},create:{id:function(){t=(Math.random().toString(16)+"000000000").substr(2,8),s="."+t,w.verbose("Creating unique id for element",t)}},destroy:function(){w.verbose("Destroying previous module for",F),F.off(D).removeData(E),w.is.ios()&&w.remove.ios(),G.off(s),h.off(s),i.off(s)},event:{clickaway:function(a){var b=J.find(a.target).length>0||J.is(a.target),c=G.is(a.target);b&&(w.verbose("User clicked on dimmed page"),w.hide()),c&&(w.verbose("User clicked on dimmable context (scaled out page)"),w.hide())},touch:function(a){},containScroll:function(a){K.scrollTop<=0&&(K.scrollTop=1),K.scrollTop+K.offsetHeight>=K.scrollHeight&&(K.scrollTop=K.scrollHeight-K.offsetHeight-1)},scroll:function(b){0===a(b.target).closest(y.sidebar).length&&b.preventDefault()}},bind:{clickaway:function(){w.verbose("Adding clickaway events to context",G),x.closable&&G.on("click"+s,w.event.clickaway).on("touchend"+s,w.event.clickaway)},scrollLock:function(){x.scrollLock&&(w.debug("Disabling page scroll"),h.on("DOMMouseScroll"+s,w.event.scroll)),w.verbose("Adding events to contain sidebar scroll"),i.on("touchmove"+s,w.event.touch),F.on("scroll"+D,w.event.containScroll)}},unbind:{clickaway:function(){w.verbose("Removing clickaway events from context",G),G.off(s)},scrollLock:function(){w.verbose("Removing scroll lock from page"),i.off(s),h.off(s),F.off("scroll"+D)}},add:{inlineCSS:function(){var b,c=w.cache.width||F.outerWidth(),d=w.cache.height||F.outerHeight(),e=w.is.rtl(),f=w.get.direction(),h={left:c,right:-c,top:d,bottom:-d};e&&(w.verbose("RTL detected, flipping widths"),h.left=-c,h.right=c),b="<style>","left"===f||"right"===f?(w.debug("Adding CSS rules for animation distance",c),b+=" .ui.visible."+f+".sidebar ~ .fixed, .ui.visible."+f+".sidebar ~ .pusher {   -webkit-transform: translate3d("+h[f]+"px, 0, 0);           transform: translate3d("+h[f]+"px, 0, 0); }"):("top"===f||"bottom"==f)&&(b+=" .ui.visible."+f+".sidebar ~ .fixed, .ui.visible."+f+".sidebar ~ .pusher {   -webkit-transform: translate3d(0, "+h[f]+"px, 0);           transform: translate3d(0, "+h[f]+"px, 0); }"),
w.is.ie()&&("left"===f||"right"===f?(w.debug("Adding CSS rules for animation distance",c),b+=" body.pushable > .ui.visible."+f+".sidebar ~ .pusher:after {   -webkit-transform: translate3d("+h[f]+"px, 0, 0);           transform: translate3d("+h[f]+"px, 0, 0); }"):("top"===f||"bottom"==f)&&(b+=" body.pushable > .ui.visible."+f+".sidebar ~ .pusher:after {   -webkit-transform: translate3d(0, "+h[f]+"px, 0);           transform: translate3d(0, "+h[f]+"px, 0); }"),b+=" body.pushable > .ui.visible.left.sidebar ~ .ui.visible.right.sidebar ~ .pusher:after, body.pushable > .ui.visible.right.sidebar ~ .ui.visible.left.sidebar ~ .pusher:after {   -webkit-transform: translate3d(0px, 0, 0);           transform: translate3d(0px, 0, 0); }"),b+="</style>",g=a(b).appendTo(k),w.debug("Adding sizing css to head",g)}},refresh:function(){w.verbose("Refreshing selector cache"),G=a(x.context),H=G.children(y.sidebar),J=G.children(y.pusher),I=G.children(y.fixed),w.clear.cache()},refreshSidebars:function(){w.verbose("Refreshing other sidebars"),H=G.children(y.sidebar)},repaint:function(){w.verbose("Forcing repaint event"),K.style.display="none",K.offsetHeight,K.scrollTop=K.scrollTop,K.style.display=""},setup:{cache:function(){w.cache={width:F.outerWidth(),height:F.outerHeight(),rtl:"rtl"==F.css("direction")}},layout:function(){0===G.children(y.pusher).length&&(w.debug("Adding wrapper element for sidebar"),w.error(C.pusher),J=a('<div class="pusher" />'),G.children().not(y.omitted).not(H).wrapAll(J),w.refresh()),(0===F.nextAll(y.pusher).length||F.nextAll(y.pusher)[0]!==J[0])&&(w.debug("Moved sidebar to correct parent element"),w.error(C.movedSidebar,K),F.detach().prependTo(G),w.refresh()),w.clear.cache(),w.set.pushable(),w.set.direction()}},attachEvents:function(b,c){var d=a(b);c=a.isFunction(w[c])?w[c]:w.toggle,d.length>0?(w.debug("Attaching sidebar events to element",b,c),d.on("click"+D,c)):w.error(C.notFound,b)},show:function(b){if(b=a.isFunction(b)?b:function(){},w.is.hidden()){if(w.refreshSidebars(),x.overlay&&(w.error(C.overlay),x.transition="overlay"),w.refresh(),w.othersActive())if(w.debug("Other sidebars currently visible"),x.exclusive){if("overlay"!=x.transition)return void w.hideOthers(w.show);w.hideOthers()}else x.transition="overlay";w.pushPage(function(){b.call(K),x.onShow.call(K)}),x.onChange.call(K),x.onVisible.call(K)}else w.debug("Sidebar is already visible")},hide:function(b){b=a.isFunction(b)?b:function(){},(w.is.visible()||w.is.animating())&&(w.debug("Hiding sidebar",b),w.refreshSidebars(),w.pullPage(function(){b.call(K),x.onHidden.call(K)}),x.onChange.call(K),x.onHide.call(K))},othersAnimating:function(){return H.not(F).filter("."+z.animating).length>0},othersVisible:function(){return H.not(F).filter("."+z.visible).length>0},othersActive:function(){return w.othersVisible()||w.othersAnimating()},hideOthers:function(a){var b=H.not(F).filter("."+z.visible),c=b.length,d=0;a=a||function(){},b.sidebar("hide",function(){d++,d==c&&a()})},toggle:function(){w.verbose("Determining toggled direction"),w.is.hidden()?w.show():w.hide()},pushPage:function(b){var c,d,e,f=w.get.transition(),g="overlay"===f||w.othersActive()?F:J;b=a.isFunction(b)?b:function(){},"scale down"==x.transition&&w.scrollToTop(),w.set.transition(f),w.repaint(),c=function(){w.bind.clickaway(),w.add.inlineCSS(),w.set.animating(),w.set.visible()},d=function(){w.set.dimmed()},e=function(a){a.target==g[0]&&(g.off(v+s,e),w.remove.animating(),w.bind.scrollLock(),b.call(K))},g.off(v+s),g.on(v+s,e),r(c),x.dimPage&&!w.othersVisible()&&r(d)},pullPage:function(b){var c,d,e=w.get.transition(),f="overlay"==e||w.othersActive()?F:J;b=a.isFunction(b)?b:function(){},w.verbose("Removing context push state",w.get.direction()),w.unbind.clickaway(),w.unbind.scrollLock(),c=function(){w.set.transition(e),w.set.animating(),w.remove.visible(),x.dimPage&&!w.othersVisible()&&J.removeClass(z.dimmed)},d=function(a){a.target==f[0]&&(f.off(v+s,d),w.remove.animating(),w.remove.transition(),w.remove.inlineCSS(),("scale down"==e||x.returnScroll&&w.is.mobile())&&w.scrollBack(),b.call(K))},f.off(v+s),f.on(v+s,d),r(c)},scrollToTop:function(){w.verbose("Scrolling to top of page to avoid animation issues"),u=a(b).scrollTop(),F.scrollTop(0),b.scrollTo(0,0)},scrollBack:function(){w.verbose("Scrolling back to original page position"),b.scrollTo(0,u)},clear:{cache:function(){w.verbose("Clearing cached dimensions"),w.cache={}}},set:{ios:function(){j.addClass(z.ios)},pushed:function(){G.addClass(z.pushed)},pushable:function(){G.addClass(z.pushable)},dimmed:function(){J.addClass(z.dimmed)},active:function(){F.addClass(z.active)},animating:function(){F.addClass(z.animating)},transition:function(a){a=a||w.get.transition(),F.addClass(a)},direction:function(a){a=a||w.get.direction(),F.addClass(z[a])},visible:function(){F.addClass(z.visible)},overlay:function(){F.addClass(z.overlay)}},remove:{inlineCSS:function(){w.debug("Removing inline css styles",g),g&&g.length>0&&g.remove()},ios:function(){j.removeClass(z.ios)},pushed:function(){G.removeClass(z.pushed)},pushable:function(){G.removeClass(z.pushable)},active:function(){F.removeClass(z.active)},animating:function(){F.removeClass(z.animating)},transition:function(a){a=a||w.get.transition(),F.removeClass(a)},direction:function(a){a=a||w.get.direction(),F.removeClass(z[a])},visible:function(){F.removeClass(z.visible)},overlay:function(){F.removeClass(z.overlay)}},get:{direction:function(){return F.hasClass(z.top)?z.top:F.hasClass(z.right)?z.right:F.hasClass(z.bottom)?z.bottom:z.left},transition:function(){var a,b=w.get.direction();return a=w.is.mobile()?"auto"==x.mobileTransition?x.defaultTransition.mobile[b]:x.mobileTransition:"auto"==x.transition?x.defaultTransition.computer[b]:x.transition,w.verbose("Determined transition",a),a},transitionEvent:function(){var a,b=c.createElement("element"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in e)if(b.style[a]!==d)return e[a]}},is:{ie:function(){var a=!b.ActiveXObject&&"ActiveXObject"in b,c="ActiveXObject"in b;return a||c},ios:function(){var a=navigator.userAgent,b=a.match(B.ios),c=a.match(B.mobileChrome);return!(!b||c)&&(w.verbose("Browser was found to be iOS",a),!0)},mobile:function(){var a=navigator.userAgent,b=a.match(B.mobile);return b?(w.verbose("Browser was found to be mobile",a),!0):(w.verbose("Browser is not mobile, using regular transition",a),!1)},hidden:function(){return!w.is.visible()},visible:function(){return F.hasClass(z.visible)},open:function(){return w.is.visible()},closed:function(){return w.is.hidden()},vertical:function(){return F.hasClass(z.top)},animating:function(){return G.hasClass(z.animating)},rtl:function(){return w.cache.rtl===d&&(w.cache.rtl="rtl"==F.css("direction")),w.cache.rtl}},setting:function(b,c){if(w.debug("Changing setting",b,c),a.isPlainObject(b))a.extend(!0,x,b);else{if(c===d)return x[b];a.isPlainObject(x[b])?a.extend(!0,x[b],c):x[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,w,b);else{if(c===d)return w[b];w[b]=c}},debug:function(){!x.silent&&x.debug&&(x.performance?w.performance.log(arguments):(w.debug=Function.prototype.bind.call(console.info,console,x.name+":"),w.debug.apply(console,arguments)))},verbose:function(){!x.silent&&x.verbose&&x.debug&&(x.performance?w.performance.log(arguments):(w.verbose=Function.prototype.bind.call(console.info,console,x.name+":"),w.verbose.apply(console,arguments)))},error:function(){x.silent||(w.error=Function.prototype.bind.call(console.error,console,x.name+":"),w.error.apply(console,arguments))},performance:{log:function(a){var b,c,d;x.performance&&(b=(new Date).getTime(),d=m||b,c=b-d,m=b,n.push({Name:a[0],Arguments:[].slice.call(a,1)||"",Element:K,"Execution Time":c})),clearTimeout(w.performance.timer),w.performance.timer=setTimeout(w.performance.display,500)},display:function(){var b=x.name+":",c=0;m=!1,clearTimeout(w.performance.timer),a.each(n,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",l&&(b+=" '"+l+"'"),(console.group!==d||console.table!==d)&&n.length>0&&(console.groupCollapsed(b),console.table?console.table(n):a.each(n,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),n=[]}},invoke:function(b,c,e){var g,h,i,j=L;return c=c||q,e=K||e,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d?(h=j[e],!1):(w.error(C.method,b),!1);j=j[e]}})),a.isFunction(h)?i=h.apply(e,c):h!==d&&(i=h),a.isArray(f)?f.push(i):f!==d?f=[f,i]:i!==d&&(f=i),h}},p?(L===d&&w.initialize(),w.invoke(o)):(L!==d&&w.invoke("destroy"),w.initialize())}),f!==d?f:this},a.fn.sidebar.settings={name:"Sidebar",namespace:"sidebar",silent:!1,debug:!1,verbose:!1,performance:!0,transition:"auto",mobileTransition:"auto",defaultTransition:{computer:{left:"uncover",right:"uncover",top:"overlay",bottom:"overlay"},mobile:{left:"uncover",right:"uncover",top:"overlay",bottom:"overlay"}},context:"body",exclusive:!1,closable:!0,dimPage:!0,scrollLock:!1,returnScroll:!1,delaySetup:!1,duration:500,onChange:function(){},onShow:function(){},onHide:function(){},onHidden:function(){},onVisible:function(){},className:{active:"active",animating:"animating",dimmed:"dimmed",ios:"ios",pushable:"pushable",pushed:"pushed",right:"right",top:"top",left:"left",bottom:"bottom",visible:"visible"},selector:{fixed:".fixed",omitted:"script, link, style, .ui.modal, .ui.dimmer, .ui.nag, .ui.fixed",pusher:".pusher",sidebar:".ui.sidebar"},regExp:{ios:/(iPad|iPhone|iPod)/g,mobileChrome:/(CriOS)/g,mobile:/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/g},error:{method:"The method you called is not defined.",pusher:"Had to add pusher element. For optimal performance make sure body content is inside a pusher element",movedSidebar:"Had to move sidebar. For optimal performance make sure sidebar and pusher are direct children of your body tag",overlay:"The overlay setting is no longer supported, use animation: overlay",notFound:"There were no elements that matched the specified selector"}}}(jQuery,window,document),!function(a,b,c,d){"use strict";b="undefined"!=typeof b&&b.Math==Math?b:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),a.fn.checkbox=function(e){var f,g=a(this),h=g.selector||"",i=(new Date).getTime(),j=[],k=arguments[0],l="string"==typeof k,m=[].slice.call(arguments,1);return g.each(function(){var g,n,o=a.extend(!0,{},a.fn.checkbox.settings,e),p=o.className,q=o.namespace,r=o.selector,s=o.error,t="."+q,u="module-"+q,v=a(this),w=a(this).children(r.label),x=a(this).children(r.input),y=x[0],z=!1,A=!1,B=v.data(u),C=this;n={initialize:function(){n.verbose("Initializing checkbox",o),n.create.label(),n.bind.events(),n.set.tabbable(),n.hide.input(),n.observeChanges(),n.instantiate(),n.setup()},instantiate:function(){n.verbose("Storing instance of module",n),B=n,v.data(u,n)},destroy:function(){n.verbose("Destroying module"),n.unbind.events(),n.show.input(),v.removeData(u)},fix:{reference:function(){v.is(r.input)&&(n.debug("Behavior called on <input> adjusting invoked element"),v=v.closest(r.checkbox),n.refresh())}},setup:function(){n.set.initialLoad(),n.is.indeterminate()?(n.debug("Initial value is indeterminate"),n.indeterminate()):n.is.checked()?(n.debug("Initial value is checked"),n.check()):(n.debug("Initial value is unchecked"),n.uncheck()),n.remove.initialLoad()},refresh:function(){w=v.children(r.label),x=v.children(r.input),y=x[0]},hide:{input:function(){n.verbose("Modifying <input> z-index to be unselectable"),x.addClass(p.hidden)}},show:{input:function(){n.verbose("Modifying <input> z-index to be selectable"),x.removeClass(p.hidden)}},observeChanges:function(){"MutationObserver"in b&&(g=new MutationObserver(function(a){n.debug("DOM tree modified, updating selector cache"),n.refresh()}),g.observe(C,{childList:!0,subtree:!0}),n.debug("Setting up mutation observer",g))},attachEvents:function(b,c){var d=a(b);c=a.isFunction(n[c])?n[c]:n.toggle,d.length>0?(n.debug("Attaching checkbox events to element",b,c),d.on("click"+t,c)):n.error(s.notFound)},event:{click:function(b){var c=a(b.target);return c.is(r.input)?void n.verbose("Using default check action on initialized checkbox"):c.is(r.link)?void n.debug("Clicking link inside checkbox, skipping toggle"):(n.toggle(),x.focus(),void b.preventDefault())},keydown:function(a){var b=a.which,c={enter:13,space:32,escape:27};b==c.escape?(n.verbose("Escape key pressed blurring field"),x.blur(),A=!0):a.ctrlKey||b!=c.space&&b!=c.enter?A=!1:(n.verbose("Enter/space key pressed, toggling checkbox"),n.toggle(),A=!0)},keyup:function(a){A&&a.preventDefault()}},check:function(){n.should.allowCheck()&&(n.debug("Checking checkbox",x),n.set.checked(),n.should.ignoreCallbacks()||(o.onChecked.call(y),o.onChange.call(y)))},uncheck:function(){n.should.allowUncheck()&&(n.debug("Unchecking checkbox"),n.set.unchecked(),n.should.ignoreCallbacks()||(o.onUnchecked.call(y),o.onChange.call(y)))},indeterminate:function(){return n.should.allowIndeterminate()?void n.debug("Checkbox is already indeterminate"):(n.debug("Making checkbox indeterminate"),n.set.indeterminate(),void(n.should.ignoreCallbacks()||(o.onIndeterminate.call(y),o.onChange.call(y))))},determinate:function(){return n.should.allowDeterminate()?void n.debug("Checkbox is already determinate"):(n.debug("Making checkbox determinate"),n.set.determinate(),void(n.should.ignoreCallbacks()||(o.onDeterminate.call(y),o.onChange.call(y))))},enable:function(){return n.is.enabled()?void n.debug("Checkbox is already enabled"):(n.debug("Enabling checkbox"),n.set.enabled(),o.onEnable.call(y),void o.onEnabled.call(y))},disable:function(){return n.is.disabled()?void n.debug("Checkbox is already disabled"):(n.debug("Disabling checkbox"),n.set.disabled(),o.onDisable.call(y),void o.onDisabled.call(y))},get:{radios:function(){var b=n.get.name();return a('input[name="'+b+'"]').closest(r.checkbox)},otherRadios:function(){return n.get.radios().not(v)},name:function(){return x.attr("name")}},is:{initialLoad:function(){return z},radio:function(){return x.hasClass(p.radio)||"radio"==x.attr("type")},indeterminate:function(){return x.prop("indeterminate")!==d&&x.prop("indeterminate")},checked:function(){return x.prop("checked")!==d&&x.prop("checked")},disabled:function(){return x.prop("disabled")!==d&&x.prop("disabled")},enabled:function(){return!n.is.disabled()},determinate:function(){return!n.is.indeterminate()},unchecked:function(){return!n.is.checked()}},should:{allowCheck:function(){return n.is.determinate()&&n.is.checked()&&!n.should.forceCallbacks()?(n.debug("Should not allow check, checkbox is already checked"),!1):o.beforeChecked.apply(y)!==!1||(n.debug("Should not allow check, beforeChecked cancelled"),!1)},allowUncheck:function(){return n.is.determinate()&&n.is.unchecked()&&!n.should.forceCallbacks()?(n.debug("Should not allow uncheck, checkbox is already unchecked"),!1):o.beforeUnchecked.apply(y)!==!1||(n.debug("Should not allow uncheck, beforeUnchecked cancelled"),!1)},allowIndeterminate:function(){return n.is.indeterminate()&&!n.should.forceCallbacks()?(n.debug("Should not allow indeterminate, checkbox is already indeterminate"),!1):o.beforeIndeterminate.apply(y)!==!1||(n.debug("Should not allow indeterminate, beforeIndeterminate cancelled"),!1)},allowDeterminate:function(){return n.is.determinate()&&!n.should.forceCallbacks()?(n.debug("Should not allow determinate, checkbox is already determinate"),!1):o.beforeDeterminate.apply(y)!==!1||(n.debug("Should not allow determinate, beforeDeterminate cancelled"),!1)},forceCallbacks:function(){return n.is.initialLoad()&&o.fireOnInit},ignoreCallbacks:function(){return z&&!o.fireOnInit}},can:{change:function(){return!(v.hasClass(p.disabled)||v.hasClass(p.readOnly)||x.prop("disabled")||x.prop("readonly"))},uncheck:function(){return"boolean"==typeof o.uncheckable?o.uncheckable:!n.is.radio()}},set:{initialLoad:function(){z=!0},checked:function(){return n.verbose("Setting class to checked"),v.removeClass(p.indeterminate).addClass(p.checked),n.is.radio()&&n.uncheckOthers(),!n.is.indeterminate()&&n.is.checked()?void n.debug("Input is already checked, skipping input property change"):(n.verbose("Setting state to checked",y),x.prop("indeterminate",!1).prop("checked",!0),void n.trigger.change())},unchecked:function(){return n.verbose("Removing checked class"),v.removeClass(p.indeterminate).removeClass(p.checked),!n.is.indeterminate()&&n.is.unchecked()?void n.debug("Input is already unchecked"):(n.debug("Setting state to unchecked"),x.prop("indeterminate",!1).prop("checked",!1),void n.trigger.change())},indeterminate:function(){return n.verbose("Setting class to indeterminate"),v.addClass(p.indeterminate),n.is.indeterminate()?void n.debug("Input is already indeterminate, skipping input property change"):(n.debug("Setting state to indeterminate"),x.prop("indeterminate",!0),void n.trigger.change())},determinate:function(){return n.verbose("Removing indeterminate class"),v.removeClass(p.indeterminate),n.is.determinate()?void n.debug("Input is already determinate, skipping input property change"):(n.debug("Setting state to determinate"),void x.prop("indeterminate",!1))},disabled:function(){return n.verbose("Setting class to disabled"),v.addClass(p.disabled),n.is.disabled()?void n.debug("Input is already disabled, skipping input property change"):(n.debug("Setting state to disabled"),x.prop("disabled","disabled"),void n.trigger.change())},enabled:function(){return n.verbose("Removing disabled class"),v.removeClass(p.disabled),n.is.enabled()?void n.debug("Input is already enabled, skipping input property change"):(n.debug("Setting state to enabled"),x.prop("disabled",!1),void n.trigger.change())},tabbable:function(){n.verbose("Adding tabindex to checkbox"),x.attr("tabindex")===d&&x.attr("tabindex",0)}},remove:{initialLoad:function(){z=!1}},trigger:{change:function(){var a=c.createEvent("HTMLEvents"),b=x[0];b&&(n.verbose("Triggering native change event"),a.initEvent("change",!0,!1),b.dispatchEvent(a))}},create:{label:function(){x.prevAll(r.label).length>0?(x.prev(r.label).detach().insertAfter(x),n.debug("Moving existing label",w)):n.has.label()||(w=a("<label>").insertAfter(x),n.debug("Creating label",w))}},has:{label:function(){return w.length>0}},bind:{events:function(){n.verbose("Attaching checkbox events"),v.on("click"+t,n.event.click).on("keydown"+t,r.input,n.event.keydown).on("keyup"+t,r.input,n.event.keyup)}},unbind:{events:function(){n.debug("Removing events"),v.off(t)}},uncheckOthers:function(){var a=n.get.otherRadios();n.debug("Unchecking other radios",a),a.removeClass(p.checked)},toggle:function(){return n.can.change()?void(n.is.indeterminate()||n.is.unchecked()?(n.debug("Currently unchecked"),n.check()):n.is.checked()&&n.can.uncheck()&&(n.debug("Currently checked"),n.uncheck())):void(n.is.radio()||n.debug("Checkbox is read-only or disabled, ignoring toggle"))},setting:function(b,c){if(n.debug("Changing setting",b,c),a.isPlainObject(b))a.extend(!0,o,b);else{if(c===d)return o[b];a.isPlainObject(o[b])?a.extend(!0,o[b],c):o[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,n,b);else{if(c===d)return n[b];n[b]=c}},debug:function(){!o.silent&&o.debug&&(o.performance?n.performance.log(arguments):(n.debug=Function.prototype.bind.call(console.info,console,o.name+":"),n.debug.apply(console,arguments)))},verbose:function(){!o.silent&&o.verbose&&o.debug&&(o.performance?n.performance.log(arguments):(n.verbose=Function.prototype.bind.call(console.info,console,o.name+":"),n.verbose.apply(console,arguments)))},error:function(){o.silent||(n.error=Function.prototype.bind.call(console.error,console,o.name+":"),n.error.apply(console,arguments))},performance:{log:function(a){var b,c,d;o.performance&&(b=(new Date).getTime(),d=i||b,c=b-d,i=b,j.push({Name:a[0],Arguments:[].slice.call(a,1)||"",Element:C,"Execution Time":c})),clearTimeout(n.performance.timer),n.performance.timer=setTimeout(n.performance.display,500)},display:function(){var b=o.name+":",c=0;i=!1,clearTimeout(n.performance.timer),a.each(j,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",h&&(b+=" '"+h+"'"),(console.group!==d||console.table!==d)&&j.length>0&&(console.groupCollapsed(b),console.table?console.table(j):a.each(j,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),j=[]}},invoke:function(b,c,e){var g,h,i,j=B;return c=c||m,e=C||e,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d?(h=j[e],!1):(n.error(s.method,b),!1);j=j[e]}})),a.isFunction(h)?i=h.apply(e,c):h!==d&&(i=h),a.isArray(f)?f.push(i):f!==d?f=[f,i]:i!==d&&(f=i),h}},l?(B===d&&n.initialize(),n.invoke(k)):(B!==d&&B.invoke("destroy"),n.initialize())}),f!==d?f:this},a.fn.checkbox.settings={name:"Checkbox",namespace:"checkbox",silent:!1,debug:!1,verbose:!0,performance:!0,uncheckable:"auto",fireOnInit:!1,onChange:function(){},beforeChecked:function(){},beforeUnchecked:function(){},beforeDeterminate:function(){},beforeIndeterminate:function(){},onChecked:function(){},onUnchecked:function(){},onDeterminate:function(){},onIndeterminate:function(){},onEnable:function(){},onDisable:function(){},onEnabled:function(){},onDisabled:function(){},className:{checked:"checked",indeterminate:"indeterminate",disabled:"disabled",hidden:"hidden",radio:"radio",readOnly:"read-only"},error:{method:"The method you called is not defined"},selector:{checkbox:".ui.checkbox",label:"label, .box",input:'input[type="checkbox"], input[type="radio"]',link:"a[href]"}}}(jQuery,window,document),!function(a,b,c,d){"use strict";var b="undefined"!=typeof b&&b.Math==Math?b:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();a.api=a.fn.api=function(c){var e,f=a(a.isFunction(this)?b:this),g=f.selector||"",h=(new Date).getTime(),i=[],j=arguments[0],k="string"==typeof j,l=[].slice.call(arguments,1);return f.each(function(){var f,m,n,o,p,q,r=a.isPlainObject(c)?a.extend(!0,{},a.fn.api.settings,c):a.extend({},a.fn.api.settings),s=r.namespace,t=r.metadata,u=r.selector,v=r.error,w=r.className,x="."+s,y="module-"+s,z=a(this),A=z.closest(u.form),B=r.stateContext?a(r.stateContext):z,C=this,D=B[0],E=z.data(y);q={initialize:function(){k||q.bind.events(),q.instantiate()},instantiate:function(){q.verbose("Storing instance of module",q),E=q,z.data(y,E)},destroy:function(){q.verbose("Destroying previous module for",C),z.removeData(y).off(x)},bind:{events:function(){var a=q.get.event();a?(q.verbose("Attaching API events to element",a),z.on(a+x,q.event.trigger)):"now"==r.on&&(q.debug("Querying API endpoint immediately"),q.query())}},decode:{json:function(a){if(a!==d&&"string"==typeof a)try{a=JSON.parse(a)}catch(a){}return a}},read:{cachedResponse:function(a){var c;return b.Storage===d?void q.error(v.noStorage):(c=sessionStorage.getItem(a),q.debug("Using cached response",a,c),c=q.decode.json(c))}},write:{cachedResponse:function(c,e){return e&&""===e?void q.debug("Response empty, not caching",e):b.Storage===d?void q.error(v.noStorage):(a.isPlainObject(e)&&(e=JSON.stringify(e)),sessionStorage.setItem(c,e),void q.verbose("Storing cached response for url",c,e))}},query:function(){if(q.is.disabled())return void q.debug("Element is disabled API request aborted");if(q.is.loading()){if(!r.interruptRequests)return void q.debug("Cancelling request, previous request is still pending");q.debug("Interrupting previous request"),q.abort()}return r.defaultData&&a.extend(!0,r.urlData,q.get.defaultData()),r.serializeForm&&(r.data=q.add.formData(r.data)),m=q.get.settings(),m===!1?(q.cancelled=!0,void q.error(v.beforeSend)):(q.cancelled=!1,n=q.get.templatedURL(),n||q.is.mocked()?(n=q.add.urlData(n),n||q.is.mocked()?(m.url=r.base+n,f=a.extend(!0,{},r,{type:r.method||r.type,data:o,url:r.base+n,beforeSend:r.beforeXHR,success:function(){},failure:function(){},complete:function(){}}),q.debug("Querying URL",f.url),q.verbose("Using AJAX settings",f),"local"===r.cache&&q.read.cachedResponse(n)?(q.debug("Response returned from local cache"),q.request=q.create.request(),void q.request.resolveWith(D,[q.read.cachedResponse(n)])):void(r.throttle?r.throttleFirstRequest||q.timer?(q.debug("Throttling request",r.throttle),clearTimeout(q.timer),q.timer=setTimeout(function(){q.timer&&delete q.timer,q.debug("Sending throttled request",o,f.method),q.send.request()},r.throttle)):(q.debug("Sending request",o,f.method),q.send.request(),q.timer=setTimeout(function(){},r.throttle)):(q.debug("Sending request",o,f.method),q.send.request()))):void 0):void q.error(v.missingURL))},should:{removeError:function(){return r.hideError===!0||"auto"===r.hideError&&!q.is.form()}},is:{disabled:function(){return z.filter(u.disabled).length>0},expectingJSON:function(){return"json"===r.dataType||"jsonp"===r.dataType},form:function(){return z.is("form")||B.is("form")},mocked:function(){return r.mockResponse||r.mockResponseAsync||r.response||r.responseAsync},input:function(){return z.is("input")},loading:function(){return!!q.request&&"pending"==q.request.state()},abortedRequest:function(a){return a&&a.readyState!==d&&0===a.readyState?(q.verbose("XHR request determined to be aborted"),!0):(q.verbose("XHR request was not aborted"),!1)},validResponse:function(b){return q.is.expectingJSON()&&a.isFunction(r.successTest)?(q.debug("Checking JSON returned success",r.successTest,b),r.successTest(b)?(q.debug("Response passed success test",b),!0):(q.debug("Response failed success test",b),!1)):(q.verbose("Response is not JSON, skipping validation",r.successTest,b),!0)}},was:{cancelled:function(){return q.cancelled||!1},succesful:function(){return q.request&&"resolved"==q.request.state()},failure:function(){return q.request&&"rejected"==q.request.state()},complete:function(){return q.request&&("resolved"==q.request.state()||"rejected"==q.request.state())}},add:{urlData:function(b,c){var e,f;return b&&(e=b.match(r.regExp.required),f=b.match(r.regExp.optional),c=c||r.urlData,e&&(q.debug("Looking for required URL variables",e),a.each(e,function(e,f){var g=-1!==f.indexOf("$")?f.substr(2,f.length-3):f.substr(1,f.length-2),h=a.isPlainObject(c)&&c[g]!==d?c[g]:z.data(g)!==d?z.data(g):B.data(g)!==d?B.data(g):c[g];return h===d?(q.error(v.requiredParameter,g,b),b=!1,!1):(q.verbose("Found required variable",g,h),h=r.encodeParameters?q.get.urlEncodedValue(h):h,void(b=b.replace(f,h)))})),f&&(q.debug("Looking for optional URL variables",e),a.each(f,function(e,f){var g=-1!==f.indexOf("$")?f.substr(3,f.length-4):f.substr(2,f.length-3),h=a.isPlainObject(c)&&c[g]!==d?c[g]:z.data(g)!==d?z.data(g):B.data(g)!==d?B.data(g):c[g];h!==d?(q.verbose("Optional variable Found",g,h),b=b.replace(f,h)):(q.verbose("Optional variable not found",g),b=-1!==b.indexOf("/"+f)?b.replace("/"+f,""):b.replace(f,""))}))),b},formData:function(b){var c,e=a.fn.serializeObject!==d,f=e?A.serializeObject():A.serialize();return b=b||r.data,c=a.isPlainObject(b),c?e?(q.debug("Extending existing data with form data",b,f),b=a.extend(!0,{},b,f)):(q.error(v.missingSerialize),q.debug("Cant extend data. Replacing data with form data",b,f),b=f):(q.debug("Adding form data",f),b=f),b}},send:{request:function(){q.set.loading(),q.request=q.create.request(),q.is.mocked()?q.mockedXHR=q.create.mockedXHR():q.xhr=q.create.xhr(),r.onRequest.call(D,q.request,q.xhr)}},event:{trigger:function(a){q.query(),("submit"==a.type||"click"==a.type)&&a.preventDefault()},xhr:{always:function(){},done:function(b,c,d){var e=this,f=(new Date).getTime()-p,g=r.loadingDuration-f,h=!!a.isFunction(r.onResponse)&&(q.is.expectingJSON()?r.onResponse.call(e,a.extend(!0,{},b)):r.onResponse.call(e,b));g=g>0?g:0,h&&(q.debug("Modified API response in onResponse callback",r.onResponse,h,b),b=h),g>0&&q.debug("Response completed early delaying state change by",g),setTimeout(function(){q.is.validResponse(b)?q.request.resolveWith(e,[b,d]):q.request.rejectWith(e,[d,"invalid"])},g)},fail:function(a,b,c){var d=this,e=(new Date).getTime()-p,f=r.loadingDuration-e;f=f>0?f:0,f>0&&q.debug("Response completed early delaying state change by",f),setTimeout(function(){q.is.abortedRequest(a)?q.request.rejectWith(d,[a,"aborted",c]):q.request.rejectWith(d,[a,"error",b,c])},f)}},request:{done:function(a,b){q.debug("Successful API Response",a),"local"===r.cache&&n&&(q.write.cachedResponse(n,a),q.debug("Saving server response locally",q.cache)),r.onSuccess.call(D,a,z,b)},complete:function(a,b){var c,d;q.was.succesful()?(d=a,c=b):(c=a,d=q.get.responseFromXHR(c)),q.remove.loading(),r.onComplete.call(D,d,z,c)},fail:function(a,b,c){var e=q.get.responseFromXHR(a),g=q.get.errorFromRequest(e,b,c);return"aborted"==b?(q.debug("XHR Aborted (Most likely caused by page navigation or CORS Policy)",b,c),r.onAbort.call(D,b,z,a),!0):("invalid"==b?q.debug("JSON did not pass success test. A server-side error has most likely occurred",e):"error"==b&&a!==d&&(q.debug("XHR produced a server error",b,c),200!=a.status&&c!==d&&""!==c&&q.error(v.statusMessage+c,f.url),r.onError.call(D,g,z,a)),r.errorDuration&&"aborted"!==b&&(q.debug("Adding error state"),q.set.error(),q.should.removeError()&&setTimeout(q.remove.error,r.errorDuration)),q.debug("API Request failed",g,a),void r.onFailure.call(D,e,z,a))}}},create:{request:function(){return a.Deferred().always(q.event.request.complete).done(q.event.request.done).fail(q.event.request.fail)},mockedXHR:function(){var b,c,d,e=!1,f=!1,g=!1,h=r.mockResponse||r.response,i=r.mockResponseAsync||r.responseAsync;return d=a.Deferred().always(q.event.xhr.complete).done(q.event.xhr.done).fail(q.event.xhr.fail),h?(a.isFunction(h)?(q.debug("Using specified synchronous callback",h),c=h.call(D,m)):(q.debug("Using settings specified response",h),c=h),d.resolveWith(D,[c,e,{responseText:c}])):a.isFunction(i)&&(b=function(a){q.debug("Async callback returned response",a),a?d.resolveWith(D,[a,e,{responseText:a}]):d.rejectWith(D,[{responseText:a},f,g])},q.debug("Using specified async response callback",i),i.call(D,m,b)),d},xhr:function(){var b;return b=a.ajax(f).always(q.event.xhr.always).done(q.event.xhr.done).fail(q.event.xhr.fail),q.verbose("Created server request",b,f),b}},set:{error:function(){q.verbose("Adding error state to element",B),B.addClass(w.error)},loading:function(){q.verbose("Adding loading state to element",B),B.addClass(w.loading),p=(new Date).getTime()}},remove:{error:function(){q.verbose("Removing error state from element",B),B.removeClass(w.error)},loading:function(){q.verbose("Removing loading state from element",B),B.removeClass(w.loading)}},get:{responseFromXHR:function(b){return!!a.isPlainObject(b)&&(q.is.expectingJSON()?q.decode.json(b.responseText):b.responseText)},errorFromRequest:function(b,c,e){return a.isPlainObject(b)&&b.error!==d?b.error:r.error[c]!==d?r.error[c]:e},request:function(){return q.request||!1},xhr:function(){return q.xhr||!1},settings:function(){var b;return b=r.beforeSend.call(D,r),b&&(b.success!==d&&(q.debug("Legacy success callback detected",b),q.error(v.legacyParameters,b.success),b.onSuccess=b.success),b.failure!==d&&(q.debug("Legacy failure callback detected",b),q.error(v.legacyParameters,b.failure),b.onFailure=b.failure),b.complete!==d&&(q.debug("Legacy complete callback detected",b),q.error(v.legacyParameters,b.complete),b.onComplete=b.complete)),b===d&&q.error(v.noReturnedValue),b===!1?b:b!==d?a.extend(!0,{},b):a.extend(!0,{},r)},urlEncodedValue:function(a){var c=b.decodeURIComponent(a),d=b.encodeURIComponent(a),e=c!==a;return e?(q.debug("URL value is already encoded, avoiding double encoding",a),a):(q.verbose("Encoding value using encodeURIComponent",a,d),
d)},defaultData:function(){var b={};return a.isWindow(C)||(q.is.input()?b.value=z.val():q.is.form()||(b.text=z.text())),b},event:function(){return a.isWindow(C)||"now"==r.on?(q.debug("API called without element, no events attached"),!1):"auto"==r.on?z.is("input")?C.oninput!==d?"input":C.onpropertychange!==d?"propertychange":"keyup":z.is("form")?"submit":"click":r.on},templatedURL:function(a){if(a=a||z.data(t.action)||r.action||!1,n=z.data(t.url)||r.url||!1)return q.debug("Using specified url",n),n;if(a){if(q.debug("Looking up url for action",a,r.api),r.api[a]===d&&!q.is.mocked())return void q.error(v.missingAction,r.action,r.api);n=r.api[a]}else q.is.form()&&(n=z.attr("action")||B.attr("action")||!1,q.debug("No url or action specified, defaulting to form action",n));return n}},abort:function(){var a=q.get.xhr();a&&"resolved"!==a.state()&&(q.debug("Cancelling API request"),a.abort())},reset:function(){q.remove.error(),q.remove.loading()},setting:function(b,c){if(q.debug("Changing setting",b,c),a.isPlainObject(b))a.extend(!0,r,b);else{if(c===d)return r[b];a.isPlainObject(r[b])?a.extend(!0,r[b],c):r[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,q,b);else{if(c===d)return q[b];q[b]=c}},debug:function(){!r.silent&&r.debug&&(r.performance?q.performance.log(arguments):(q.debug=Function.prototype.bind.call(console.info,console,r.name+":"),q.debug.apply(console,arguments)))},verbose:function(){!r.silent&&r.verbose&&r.debug&&(r.performance?q.performance.log(arguments):(q.verbose=Function.prototype.bind.call(console.info,console,r.name+":"),q.verbose.apply(console,arguments)))},error:function(){r.silent||(q.error=Function.prototype.bind.call(console.error,console,r.name+":"),q.error.apply(console,arguments))},performance:{log:function(a){var b,c,d;r.performance&&(b=(new Date).getTime(),d=h||b,c=b-d,h=b,i.push({Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(q.performance.timer),q.performance.timer=setTimeout(q.performance.display,500)},display:function(){var b=r.name+":",c=0;h=!1,clearTimeout(q.performance.timer),a.each(i,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",g&&(b+=" '"+g+"'"),(console.group!==d||console.table!==d)&&i.length>0&&(console.groupCollapsed(b),console.table?console.table(i):a.each(i,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),i=[]}},invoke:function(b,c,f){var g,h,i,j=E;return c=c||l,f=C||f,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d?(h=j[e],!1):(q.error(v.method,b),!1);j=j[e]}})),a.isFunction(h)?i=h.apply(f,c):h!==d&&(i=h),a.isArray(e)?e.push(i):e!==d?e=[e,i]:i!==d&&(e=i),h}},k?(E===d&&q.initialize(),q.invoke(j)):(E!==d&&E.invoke("destroy"),q.initialize())}),e!==d?e:this},a.api.settings={name:"API",namespace:"api",debug:!1,verbose:!1,performance:!0,api:{},cache:!0,interruptRequests:!0,on:"auto",stateContext:!1,loadingDuration:0,hideError:"auto",errorDuration:2e3,encodeParameters:!0,action:!1,url:!1,base:"",urlData:{},defaultData:!0,serializeForm:!1,throttle:0,throttleFirstRequest:!0,method:"get",data:{},dataType:"json",mockResponse:!1,mockResponseAsync:!1,response:!1,responseAsync:!1,beforeSend:function(a){return a},beforeXHR:function(a){},onRequest:function(a,b){},onResponse:!1,onSuccess:function(a,b){},onComplete:function(a,b){},onFailure:function(a,b){},onError:function(a,b){},onAbort:function(a,b){},successTest:!1,error:{beforeSend:"The before send function has aborted the request",error:"There was an error with your request",exitConditions:"API Request Aborted. Exit conditions met",JSONParse:"JSON could not be parsed during error handling",legacyParameters:"You are using legacy API success callback names",method:"The method you called is not defined",missingAction:"API action used but no url was defined",missingSerialize:"jquery-serialize-object is required to add form data to an existing data object",missingURL:"No URL specified for api event",noReturnedValue:"The beforeSend callback must return a settings object, beforeSend ignored.",noStorage:"Caching responses locally requires session storage",parseError:"There was an error parsing your request",requiredParameter:"Missing a required URL parameter: ",statusMessage:"Server gave an error: ",timeout:"Your request timed out"},regExp:{required:/\{\$*[A-z0-9]+\}/g,optional:/\{\/\$*[A-z0-9]+\}/g},className:{loading:"loading",error:"error"},selector:{disabled:".disabled",form:"form"},metadata:{action:"action",url:"url"}}}(jQuery,window,document),!function(a,b,c,d){"use strict";b="undefined"!=typeof b&&b.Math==Math?b:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),a.fn.search=function(e){var f,g=a(this),h=g.selector||"",i=(new Date).getTime(),j=[],k=arguments[0],l="string"==typeof k,m=[].slice.call(arguments,1);return a(this).each(function(){var n,o=a.isPlainObject(e)?a.extend(!0,{},a.fn.search.settings,e):a.extend({},a.fn.search.settings),p=o.className,q=o.metadata,r=o.regExp,s=o.fields,t=o.selector,u=o.error,v=o.namespace,w="."+v,x=v+"-module",y=a(this),z=y.find(t.prompt),A=y.find(t.searchButton),B=y.find(t.results),C=y.find(t.result),D=y.find(t.category),E=this,F=y.data(x),G=!1;n={initialize:function(){n.verbose("Initializing module"),n.determine.searchFields(),n.bind.events(),n.set.type(),n.create.results(),n.instantiate()},instantiate:function(){n.verbose("Storing instance of module",n),F=n,y.data(x,n)},destroy:function(){n.verbose("Destroying instance"),y.off(w).removeData(x)},refresh:function(){n.debug("Refreshing selector cache"),z=y.find(t.prompt),A=y.find(t.searchButton),D=y.find(t.category),B=y.find(t.results),C=y.find(t.result)},refreshResults:function(){B=y.find(t.results),C=y.find(t.result)},bind:{events:function(){n.verbose("Binding events to search"),o.automatic&&(y.on(n.get.inputEvent()+w,t.prompt,n.event.input),z.attr("autocomplete","off")),y.on("focus"+w,t.prompt,n.event.focus).on("blur"+w,t.prompt,n.event.blur).on("keydown"+w,t.prompt,n.handleKeyboard).on("click"+w,t.searchButton,n.query).on("mousedown"+w,t.results,n.event.result.mousedown).on("mouseup"+w,t.results,n.event.result.mouseup).on("click"+w,t.result,n.event.result.click)}},determine:{searchFields:function(){e&&e.searchFields!==d&&(o.searchFields=e.searchFields)}},event:{input:function(){clearTimeout(n.timer),n.timer=setTimeout(n.query,o.searchDelay)},focus:function(){n.set.focus(),n.has.minimumCharacters()&&(n.query(),n.can.show()&&n.showResults())},blur:function(a){var b=c.activeElement===this,d=function(){n.cancel.query(),n.remove.focus(),n.timer=setTimeout(n.hideResults,o.hideDelay)};b||(n.resultsClicked?(n.debug("Determining if user action caused search to close"),y.one("click.close"+w,t.results,function(a){return n.is.inMessage(a)||G?void z.focus():(G=!1,void(n.is.animating()||n.is.hidden()||d()))})):(n.debug("Input blurred without user action, closing results"),d()))},result:{mousedown:function(){n.resultsClicked=!0},mouseup:function(){n.resultsClicked=!1},click:function(c){n.debug("Search result selected");var d=a(this),e=d.find(t.title).eq(0),f=d.is("a[href]")?d:d.find("a[href]").eq(0),g=f.attr("href")||!1,h=f.attr("target")||!1,i=(e.html(),e.length>0&&e.text()),j=n.get.results(),k=d.data(q.result)||n.get.result(i,j);return a.isFunction(o.onSelect)&&o.onSelect.call(E,k,j)===!1?(n.debug("Custom onSelect callback cancelled default select action"),void(G=!0)):(n.hideResults(),i&&n.set.value(i),void(g&&(n.verbose("Opening search link found in result",f),"_blank"==h||c.ctrlKey?b.open(g):b.location.href=g)))}}},handleKeyboard:function(a){var b,c=y.find(t.result),d=y.find(t.category),e=c.index(c.filter("."+p.active)),f=c.length,g=a.which,h={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40};if(g==h.escape&&(n.verbose("Escape key pressed, blurring search field"),n.trigger.blur()),n.is.visible())if(g==h.enter){if(n.verbose("Enter key pressed, selecting active result"),c.filter("."+p.active).length>0)return n.event.result.click.call(c.filter("."+p.active),a),a.preventDefault(),!1}else g==h.upArrow?(n.verbose("Up key pressed, changing active result"),b=0>e-1?e:e-1,d.removeClass(p.active),c.removeClass(p.active).eq(b).addClass(p.active).closest(d).addClass(p.active),a.preventDefault()):g==h.downArrow&&(n.verbose("Down key pressed, changing active result"),b=e+1>=f?e:e+1,d.removeClass(p.active),c.removeClass(p.active).eq(b).addClass(p.active).closest(d).addClass(p.active),a.preventDefault());else g==h.enter&&(n.verbose("Enter key pressed, executing query"),n.query(),n.set.buttonPressed(),z.one("keyup",n.remove.buttonFocus))},setup:{api:function(b){var c={debug:o.debug,on:!1,cache:!0,action:"search",urlData:{query:b},onSuccess:function(a){n.parse.response.call(E,a,b)},onAbort:function(a){},onFailure:function(){n.displayMessage(u.serverError)},onError:n.error};a.extend(!0,c,o.apiSettings),n.verbose("Setting up API request",c),y.api(c)}},can:{useAPI:function(){return a.fn.api!==d},show:function(){return n.is.focused()&&!n.is.visible()&&!n.is.empty()},transition:function(){return o.transition&&a.fn.transition!==d&&y.transition("is supported")}},is:{animating:function(){return B.hasClass(p.animating)},hidden:function(){return B.hasClass(p.hidden)},inMessage:function(b){return b.target&&a(b.target).closest(t.message).length>0},empty:function(){return""===B.html()},visible:function(){return B.filter(":visible").length>0},focused:function(){return z.filter(":focus").length>0}},trigger:{blur:function(){var a=c.createEvent("HTMLEvents"),b=z[0];b&&(n.verbose("Triggering native blur event"),a.initEvent("blur",!1,!1),b.dispatchEvent(a))}},get:{inputEvent:function(){var a=z[0],b=a!==d&&a.oninput!==d?"input":a!==d&&a.onpropertychange!==d?"propertychange":"keyup";return b},value:function(){return z.val()},results:function(){var a=y.data(q.results);return a},result:function(b,c){var e=["title","id"],f=!1;return b=b!==d?b:n.get.value(),c=c!==d?c:n.get.results(),"category"===o.type?(n.debug("Finding result that matches",b),a.each(c,function(c,d){return(!a.isArray(d.results)||!(f=n.search.object(b,d.results,e)[0]))&&void 0})):(n.debug("Finding result in results object",b),f=n.search.object(b,c,e)[0]),f||!1}},select:{firstResult:function(){n.verbose("Selecting first result"),C.first().addClass(p.active)}},set:{focus:function(){y.addClass(p.focus)},loading:function(){y.addClass(p.loading)},value:function(a){n.verbose("Setting search input value",a),z.val(a)},type:function(a){a=a||o.type,"category"==o.type&&y.addClass(o.type)},buttonPressed:function(){A.addClass(p.pressed)}},remove:{loading:function(){y.removeClass(p.loading)},focus:function(){y.removeClass(p.focus)},buttonPressed:function(){A.removeClass(p.pressed)}},query:function(){var b=n.get.value(),c=n.read.cache(b);n.has.minimumCharacters()?(c?(n.debug("Reading result from cache",b),n.save.results(c.results),n.addResults(c.html),n.inject.id(c.results)):(n.debug("Querying for",b),a.isPlainObject(o.source)||a.isArray(o.source)?n.search.local(b):n.can.useAPI()?n.search.remote(b):n.error(u.source)),o.onSearchQuery.call(E,b)):n.hideResults()},search:{local:function(a){var b,c=n.search.object(a,o.content);n.set.loading(),n.save.results(c),n.debug("Returned local search results",c),b=n.generateResults({results:c}),n.remove.loading(),n.addResults(b),n.inject.id(c),n.write.cache(a,{html:b,results:c})},remote:function(a){y.api("is loading")&&y.api("abort"),n.setup.api(a),y.api("query")},object:function(b,c,e){var f=[],g=[],h=b.toString().replace(r.escape,"\\$&"),i=new RegExp(r.beginsWith+h,"i"),j=function(b,c){var d=-1==a.inArray(c,f),e=-1==a.inArray(c,g);d&&e&&b.push(c)};return c=c||o.source,e=e!==d?e:o.searchFields,a.isArray(e)||(e=[e]),c===d||c===!1?(n.error(u.source),[]):(a.each(e,function(d,e){a.each(c,function(a,c){var d="string"==typeof c[e];d&&(-1!==c[e].search(i)?j(f,c):o.searchFullText&&n.fuzzySearch(b,c[e])&&j(g,c))})}),a.merge(f,g))}},fuzzySearch:function(a,b){var c=b.length,d=a.length;if("string"!=typeof a)return!1;if(a=a.toLowerCase(),b=b.toLowerCase(),d>c)return!1;if(d===c)return a===b;a:for(var e=0,f=0;d>e;e++){for(var g=a.charCodeAt(e);c>f;)if(b.charCodeAt(f++)===g)continue a;return!1}return!0},parse:{response:function(a,b){var c=n.generateResults(a);n.verbose("Parsing server response",a),a!==d&&b!==d&&a[s.results]!==d&&(n.addResults(c),n.inject.id(a[s.results]),n.write.cache(b,{html:c,results:a[s.results]}),n.save.results(a[s.results]))}},cancel:{query:function(){n.can.useAPI()&&y.api("abort")}},has:{minimumCharacters:function(){var a=n.get.value(),b=a.length;return b>=o.minCharacters}},clear:{cache:function(a){var b=y.data(q.cache);a?a&&b&&b[a]&&(n.debug("Removing value from cache",a),delete b[a],y.data(q.cache,b)):(n.debug("Clearing cache",a),y.removeData(q.cache))}},read:{cache:function(a){var b=y.data(q.cache);return!!o.cache&&(n.verbose("Checking cache for generated html for query",a),"object"==typeof b&&b[a]!==d&&b[a])}},create:{id:function(a,b){var c,e,f=a+1;return b!==d?(c=String.fromCharCode(97+b),e=c+f,n.verbose("Creating category result id",e)):(e=f,n.verbose("Creating result id",e)),e},results:function(){0===B.length&&(B=a("<div />").addClass(p.results).appendTo(y))}},inject:{result:function(a,b,c){n.verbose("Injecting result into results");var e=c!==d?B.children().eq(c).children(t.result).eq(b):B.children(t.result).eq(b);n.verbose("Injecting results metadata",e),e.data(q.result,a)},id:function(b){n.debug("Injecting unique ids into results");var c=0,e=0;return"category"===o.type?a.each(b,function(b,f){e=0,a.each(f.results,function(a,b){var g=f.results[a];g.id===d&&(g.id=n.create.id(e,c)),n.inject.result(g,e,c),e++}),c++}):a.each(b,function(a,c){var f=b[a];f.id===d&&(f.id=n.create.id(e)),n.inject.result(f,e),e++}),b}},save:{results:function(a){n.verbose("Saving current search results to metadata",a),y.data(q.results,a)}},write:{cache:function(a,b){var c=y.data(q.cache)!==d?y.data(q.cache):{};o.cache&&(n.verbose("Writing generated html to cache",a,b),c[a]=b,y.data(q.cache,c))}},addResults:function(b){return a.isFunction(o.onResultsAdd)&&o.onResultsAdd.call(B,b)===!1?(n.debug("onResultsAdd callback cancelled default action"),!1):void(b?(B.html(b),n.refreshResults(),o.selectFirstResult&&n.select.firstResult(),n.showResults()):n.hideResults())},showResults:function(){n.is.visible()||(n.can.transition()?(n.debug("Showing results with css animations"),B.transition({animation:o.transition+" in",debug:o.debug,verbose:o.verbose,duration:o.duration,queue:!0})):(n.debug("Showing results with javascript"),B.stop().fadeIn(o.duration,o.easing)),o.onResultsOpen.call(B))},hideResults:function(){n.is.visible()&&(n.can.transition()?(n.debug("Hiding results with css animations"),B.transition({animation:o.transition+" out",debug:o.debug,verbose:o.verbose,duration:o.duration,queue:!0})):(n.debug("Hiding results with javascript"),B.stop().fadeOut(o.duration,o.easing)),o.onResultsClose.call(B))},generateResults:function(b){n.debug("Generating html from response",b);var c=o.templates[o.type],d=a.isPlainObject(b[s.results])&&!a.isEmptyObject(b[s.results]),e=a.isArray(b[s.results])&&b[s.results].length>0,f="";return d||e?(o.maxResults>0&&(d?"standard"==o.type&&n.error(u.maxResults):b[s.results]=b[s.results].slice(0,o.maxResults)),a.isFunction(c)?f=c(b,s):n.error(u.noTemplate,!1)):o.showNoResults&&(f=n.displayMessage(u.noResults,"empty")),o.onResults.call(E,b),f},displayMessage:function(a,b){return b=b||"standard",n.debug("Displaying message",a,b),n.addResults(o.templates.message(a,b)),o.templates.message(a,b)},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,o,b);else{if(c===d)return o[b];o[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,n,b);else{if(c===d)return n[b];n[b]=c}},debug:function(){!o.silent&&o.debug&&(o.performance?n.performance.log(arguments):(n.debug=Function.prototype.bind.call(console.info,console,o.name+":"),n.debug.apply(console,arguments)))},verbose:function(){!o.silent&&o.verbose&&o.debug&&(o.performance?n.performance.log(arguments):(n.verbose=Function.prototype.bind.call(console.info,console,o.name+":"),n.verbose.apply(console,arguments)))},error:function(){o.silent||(n.error=Function.prototype.bind.call(console.error,console,o.name+":"),n.error.apply(console,arguments))},performance:{log:function(a){var b,c,d;o.performance&&(b=(new Date).getTime(),d=i||b,c=b-d,i=b,j.push({Name:a[0],Arguments:[].slice.call(a,1)||"",Element:E,"Execution Time":c})),clearTimeout(n.performance.timer),n.performance.timer=setTimeout(n.performance.display,500)},display:function(){var b=o.name+":",c=0;i=!1,clearTimeout(n.performance.timer),a.each(j,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",h&&(b+=" '"+h+"'"),g.length>1&&(b+=" ("+g.length+")"),(console.group!==d||console.table!==d)&&j.length>0&&(console.groupCollapsed(b),console.table?console.table(j):a.each(j,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),j=[]}},invoke:function(b,c,e){var g,h,i,j=F;return c=c||m,e=E||e,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d&&(h=j[e],!1);j=j[e]}})),a.isFunction(h)?i=h.apply(e,c):h!==d&&(i=h),a.isArray(f)?f.push(i):f!==d?f=[f,i]:i!==d&&(f=i),h}},l?(F===d&&n.initialize(),n.invoke(k)):(F!==d&&F.invoke("destroy"),n.initialize())}),f!==d?f:this},a.fn.search.settings={name:"Search",namespace:"search",silent:!1,debug:!1,verbose:!1,performance:!0,type:"standard",minCharacters:1,selectFirstResult:!1,apiSettings:!1,source:!1,searchFields:["title","description"],displayField:"",searchFullText:!0,automatic:!0,hideDelay:0,searchDelay:200,maxResults:7,cache:!0,showNoResults:!0,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:!1,onResultsAdd:!1,onSearchQuery:function(a){},onResults:function(a){},onResultsOpen:function(){},onResultsClose:function(){},className:{animating:"animating",active:"active",empty:"empty",focus:"focus",hidden:"hidden",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined."},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},fields:{categories:"results",categoryName:"name",categoryResults:"results",description:"description",image:"image",price:"price",results:"results",title:"title",url:"url",action:"action",actionText:"text",actionURL:"url"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",message:".results > .message",category:".category",result:".result",title:".title, .name"},templates:{escape:function(a){var b=/[&<>"'`]/g,c=/[&<>"'`]/,d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},e=function(a){return d[a]};return c.test(a)?a.replace(b,e):a},message:function(a,b){var c="";return a!==d&&b!==d&&(c+='<div class="message '+b+'">',c+="empty"==b?'<div class="header">No Results</div class="header"><div class="description">'+a+'</div class="description">':' <div class="description">'+a+"</div>",c+="</div>"),c},category:function(b,c){var e="";return a.fn.search.settings.templates.escape,b[c.categoryResults]!==d&&(a.each(b[c.categoryResults],function(b,f){f[c.results]!==d&&f.results.length>0&&(e+='<div class="category">',f[c.categoryName]!==d&&(e+='<div class="name">'+f[c.categoryName]+"</div>"),a.each(f.results,function(a,b){e+=b[c.url]?'<a class="result" href="'+b[c.url]+'">':'<a class="result">',b[c.image]!==d&&(e+='<div class="image"> <img src="'+b[c.image]+'"></div>'),e+='<div class="content">',b[c.price]!==d&&(e+='<div class="price">'+b[c.price]+"</div>"),b[c.title]!==d&&(e+='<div class="title">'+b[c.title]+"</div>"),b[c.description]!==d&&(e+='<div class="description">'+b[c.description]+"</div>"),e+="</div>",e+="</a>"}),e+="</div>")}),b[c.action]&&(e+='<a href="'+b[c.action][c.actionURL]+'" class="action">'+b[c.action][c.actionText]+"</a>"),e)},standard:function(b,c){var e="";return b[c.results]!==d&&(a.each(b[c.results],function(a,b){e+=b[c.url]?'<a class="result" href="'+b[c.url]+'">':'<a class="result">',b[c.image]!==d&&(e+='<div class="image"> <img src="'+b[c.image]+'"></div>'),e+='<div class="content">',b[c.price]!==d&&(e+='<div class="price">'+b[c.price]+"</div>"),b[c.title]!==d&&(e+='<div class="title">'+b[c.title]+"</div>"),b[c.description]!==d&&(e+='<div class="description">'+b[c.description]+"</div>"),e+="</div>",e+="</a>"}),b[c.action]&&(e+='<a href="'+b[c.action][c.actionURL]+'" class="action">'+b[c.action][c.actionText]+"</a>"),e)}}}}(jQuery,window,document);